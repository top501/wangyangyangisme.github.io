<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>grpc-安全认证 | WangYangYang</title><meta name="description" content="grpc-安全认证"><meta name="author" content="Wang YangYang"><meta name="copyright" content="Wang YangYang"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/theme/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="grpc-安全认证"><meta name="twitter:description" content="grpc-安全认证"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/grpc/7affa62bd4ccba7a9648054529de821e.jpg"><meta property="og:type" content="article"><meta property="og:title" content="grpc-安全认证"><meta property="og:url" content="http://wangyangyangisme.github.io/2019/09/27/grpc-grpc-%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/"><meta property="og:site_name" content="WangYangYang"><meta property="og:description" content="grpc-安全认证"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/grpc/7affa62bd4ccba7a9648054529de821e.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      now = new Date();
      hour = now.getHours();
      isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://wangyangyangisme.github.io/2019/09/27/grpc-grpc-%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/"><link rel="prev" title="grpc-错误处理和调试" href="http://wangyangyangisme.github.io/2019/09/27/grpc-grpc-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%92%8C%E8%B0%83%E8%AF%95/"><link rel="next" title="grpc-概念" href="http://wangyangyangisme.github.io/2019/09/27/grpc-grpc-%E6%A6%82%E5%BF%B5/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"C4QN4OTLJM","apiKey":"c2c026ba64eeb77abd2164975fa41f34","indexName":"wyy","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://wangyangyangisme.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: false,
  isFontAwesomeV5: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/theme/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">190</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">20</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">38</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movie/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#认证"><span class="toc-text">认证</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#支持的授权机制"><span class="toc-text">支持的授权机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSL-TLS"><span class="toc-text">SSL&#x2F;TLS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OAuth-2-0"><span class="toc-text">OAuth 2.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API"><span class="toc-text">API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务端认证加密使用的-SSL-TLS"><span class="toc-text">服务端认证加密使用的 SSL&#x2F;TLS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过-Google-进行认证"><span class="toc-text">通过 Google 进行认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展-gRPC-支持其他的认证机制"><span class="toc-text">扩展 gRPC 支持其他的认证机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#例子"><span class="toc-text">例子</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Go"><span class="toc-text">Go</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本情况-无加密或身份验证"><span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用服务器身份验证SSL-TLS"><span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过Google验证"><span class="toc-text">通过Google验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ruby"><span class="toc-text">Ruby</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本情况-无加密或身份验证-1"><span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用服务器身份验证SSL-TLS-1"><span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过Google验证-1"><span class="toc-text">通过Google验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C"><span class="toc-text">C++</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本情况-无加密或身份验证-2"><span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用服务器身份验证SSL-TLS-2"><span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#A通过Google验证"><span class="toc-text">A通过Google验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-1"><span class="toc-text">C#</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本情况-无加密或身份验证-3"><span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用服务器身份验证SSL-TLS-3"><span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#A通过Google验证-1"><span class="toc-text">A通过Google验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#验证单个RPC调用"><span class="toc-text">验证单个RPC调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python"><span class="toc-text">Python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本情况-无加密或身份验证-4"><span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用服务器身份验证SSL-TLS-4"><span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用JWT与Google进行身份验证"><span class="toc-text">使用JWT与Google进行身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用Oauth2令牌通过Google进行身份验证"><span class="toc-text">使用Oauth2令牌通过Google进行身份验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java"><span class="toc-text">Java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本情况-无加密或身份验证-5"><span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用服务器身份验证SSL-TLS-5"><span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过Google验证-2"><span class="toc-text">通过Google验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js"><span class="toc-text">Node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本情况-无加密或身份验证-6"><span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用服务器身份验证SSL-TLS-6"><span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过Google验证-3"><span class="toc-text">通过Google验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用Oauth2令牌使用Google进行身份验证（传统方法）"><span class="toc-text">使用Oauth2令牌使用Google进行身份验证（传统方法）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP"><span class="toc-text">PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本情况-无加密或身份验证-7"><span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过Google验证-4"><span class="toc-text">通过Google验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用Oauth2令牌使用Google进行身份验证（传统方法）-1"><span class="toc-text">使用Oauth2令牌使用Google进行身份验证（传统方法）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dart"><span class="toc-text">Dart</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本情况-无加密或身份验证-8"><span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用服务器身份验证SSL-TLS-7"><span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过Google验证-5"><span class="toc-text">通过Google验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#验证单个RPC调用-1"><span class="toc-text">验证单个RPC调用</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/grpc/7affa62bd4ccba7a9648054529de821e.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">WangYangYang</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movie/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">grpc-安全认证</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-09-27<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-11-06</time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/grpc/">grpc</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.9k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 13 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2019/09/27/grpc-grpc-%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2019/09/27/grpc-grpc-%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h1><p>gRPC 被设计成可以利用插件的形式支持多种授权机制。本文档对多种支持的授权机制提供了一个概览，并且用例子来论述对应API，最后就其扩展性作了讨论。 马上将会推出更多文档和例子。</p>
<h1 id="支持的授权机制"><a href="#支持的授权机制" class="headerlink" title="支持的授权机制"></a>支持的授权机制</h1><h2 id="SSL-TLS"><a href="#SSL-TLS" class="headerlink" title="SSL/TLS"></a>SSL/TLS</h2><p>gRP 集成 SSL/TLS 并对服务端授权所使用的 SSL/TLS 进行了改良，对客户端和服务端交换的所有数据进行了加密。对客户端来讲提供了可选的机制提供凭证来获得共同的授权。</p>
<h2 id="OAuth-2-0"><a href="#OAuth-2-0" class="headerlink" title="OAuth 2.0"></a>OAuth 2.0</h2><p>gRPC 提供通用的机制（后续进行描述）来对请求和应答附加基于元数据的凭证。当通过 gRPC 访问 Google API 时，会为一定的授权流程提供额外的获取访问令牌的支持，这将通过以下代码例子进行展示。 <em>警告</em>：Google OAuth2 凭证应该仅用于连接 Google 的服务。把 Google 对应的 OAuth2 令牌发往非 Google 的服务会导致令牌被窃取用作冒充客户端来访问 Google 的服务。</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>为了减少复杂性和将混乱最小化， gRPC 以一个统一的凭证对象来进行工作。 凭证可以是以下两类：</p>
<ul>
<li><p><em>频道凭证</em>, 被附加在 <code>频道</code>上， 比如 SSL 凭证。</p>
</li>
<li><p><em>调用凭证</em>, 被附加在调用上(或者 C++ 里的 <code>客户端上下文</code>)。</p>
</li>
</ul>
<p>凭证可以用<code>组合频道凭证</code>来进行组合。一个<code>组合频道凭证</code>可以将一个<code>频道凭证</code>和一个<code>调用凭证</code>关联创建一个新的<code>频道凭证</code>。结果在这个频道上的每次调用会发送组合的<code>调用凭证</code>来作为授权数据。 </p>
<p>例如，一各<code>频道凭证</code>可以由一个<code>Ssl 凭证</code>和一个<code>访问令牌凭证</code>生成。结果是在这个频道上的每次调用都会发送对应的访问令牌。 </p>
<p><code>调用凭证</code>可以用 <code>组合凭证</code>来组装。组装后的 <code>调用凭证</code>应用到一个<code>客户端上下文</code>里，将触发发送这两个<code>调用凭证</code>的授权数据。</p>
<h3 id="服务端认证加密使用的-SSL-TLS"><a href="#服务端认证加密使用的-SSL-TLS" class="headerlink" title="服务端认证加密使用的 SSL/TLS"></a>服务端认证加密使用的 SSL/TLS</h3><p>这是个最简单的认证场景：一个客户端仅仅想认证服务器并且加密所有数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a default SSL ChannelCredentials object.</span></span><br><span class="line"><span class="keyword">auto</span> channel_creds = grpc::SslCredentials(grpc::SslCredentialsOptions());</span><br><span class="line"><span class="comment">// Create a channel using the credentials created in the previous step.</span></span><br><span class="line"><span class="keyword">auto</span> channel = grpc::CreateChannel(server_name, creds);</span><br><span class="line"><span class="comment">// Create a stub on the channel.</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Greeter::Stub&gt; stub(Greeter::NewStub(channel));</span><br><span class="line"><span class="comment">// Make actual RPC calls on the stub.</span></span><br><span class="line">grpc::Status s = stub-&gt;sayHello(&amp;context, *request, response);</span><br></pre></td></tr></table></figure>

<p>对于高级的用例比如改变根 CA 或使用客户端证书，可以在发送给工厂方法的 SslCredentialsOptions 参数里的相应选项进行设置。</p>
<h3 id="通过-Google-进行认证"><a href="#通过-Google-进行认证" class="headerlink" title="通过 Google 进行认证"></a>通过 Google 进行认证</h3><p>gRPC应用可以使用一个简单的API来创建一个可以工作在不同部署场景下的凭证。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> creds = grpc::GoogleDefaultCredentials();</span><br><span class="line"><span class="comment">// Create a channel, stub and make RPC calls (same as in the previous example)</span></span><br><span class="line"><span class="keyword">auto</span> channel = grpc::CreateChannel(server_name, creds);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Greeter::Stub&gt; stub(Greeter::NewStub(channel));</span><br><span class="line">grpc::Status s = stub-&gt;sayHello(&amp;context, *request, response);</span><br></pre></td></tr></table></figure>

<p>这个应用使用的频道凭证对象就像 <a href="https://cloud.google.com/compute/" target="_blank" rel="noopener">Google 计算引擎  (GCE)</a>里运行的应用一样使用服务账号。在前面的案例里，服务账号的密钥从环境变量 <code>GOOGLE_APPLICATION_CREDENTIALS</code> 对应的文件里加载。这些密钥被用来生成承载令牌附加在在相应频道的每次 RPC 调用里。 对于 GCE 里运行的应用，可以在虚拟机设置的时候为其配置一个默认的服务账号和相应的 OAuth2 范围。在运行时，这个凭证被用来与认证系统通讯来获取 OAuth2 访问令牌并且把令牌用作在相应的频道上的 RPC 调用。</p>
<h3 id="扩展-gRPC-支持其他的认证机制"><a href="#扩展-gRPC-支持其他的认证机制" class="headerlink" title="扩展 gRPC 支持其他的认证机制"></a>扩展 gRPC 支持其他的认证机制</h3><p>相应的凭证插件 API 允许开发者开发自己的凭证插件。</p>
<ul>
<li><code>MetadataCredentialsPlugin</code> 抽象类包含需要被开发者创建的子类实现的纯虚方法 <code>GetMetadata</code>。</li>
<li><code>MetadataCredentialsFromPlugin</code> 方法可以从 <code>MetadataCredentialsPlugin</code> 创建一个 <code>调用者凭证</code>。 这类有个简单的凭证插件例子，是通过在自定义头了设置一个认证票据。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCustomAuthenticator</span> :</span> <span class="keyword">public</span> grpc::MetadataCredentialsPlugin &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  MyCustomAuthenticator(<span class="keyword">const</span> grpc::<span class="built_in">string</span>&amp; ticket) : ticket_(ticket) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  grpc::<span class="function">Status <span class="title">GetMetadata</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      grpc::string_ref service_url, grpc::string_ref method_name,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">const</span> grpc::AuthContext&amp; channel_auth_context,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="built_in">std</span>::<span class="built_in">multimap</span>&lt;grpc::<span class="built_in">string</span>, grpc::<span class="built_in">string</span>&gt;* metadata)</span> override </span>&#123;</span><br><span class="line">    metadata-&gt;insert(<span class="built_in">std</span>::make_pair(<span class="string">"x-custom-auth-ticket"</span>, ticket_));</span><br><span class="line">    <span class="keyword">return</span> grpc::Status::OK;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  grpc::<span class="built_in">string</span> ticket_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> call_creds = grpc::MetadataCredentialsFromPlugin(</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;grpc::MetadataCredentialsPlugin&gt;(</span><br><span class="line">        <span class="keyword">new</span> MyCustomAuthenticator(<span class="string">"super-secret-ticket"</span>)));</span><br></pre></td></tr></table></figure>

<p>更深层次的集成可以通过在将 gRPC 的凭证实现以插件的形式集成进核心层。gRPC 内部也允许用其他加密机制来替换 SSL/TLS 。</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>这些授权机制将会在所有 gRPC 支持的语言里提供。以下的一些节里展示了上文提到的认证和授权在每种语言里如何实现：很快将会推出更多语言的支持。</p>
<h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><h4 id="基本情况-无加密或身份验证"><a href="#基本情况-无加密或身份验证" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><p>客户端:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conn, _ := grpc.Dial(<span class="string">"localhost:50051"</span>, grpc.WithInsecure())</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">client := pb.NewGreeterClient(conn)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>服务端:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s := grpc.NewServer()</span><br><span class="line">lis, _ := net.Listen(<span class="string">"tcp"</span>, <span class="string">"localhost:50051"</span>)</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">s.Serve(lis)</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS"><a href="#使用服务器身份验证SSL-TLS" class="headerlink" title="使用服务器身份验证SSL / TLS"></a>使用服务器身份验证SSL / TLS</h4><p>客户端:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">creds, _ := credentials.NewClientTLSFromFile(certFile, <span class="string">""</span>)</span><br><span class="line">conn, _ := grpc.Dial(<span class="string">"localhost:50051"</span>, grpc.WithTransportCredentials(creds))</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">client := pb.NewGreeterClient(conn)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>服务端:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">creds, _ := credentials.NewServerTLSFromFile(certFile, keyFile)</span><br><span class="line">s := grpc.NewServer(grpc.Creds(creds))</span><br><span class="line">lis, _ := net.Listen(<span class="string">"tcp"</span>, <span class="string">"localhost:50051"</span>)</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">s.Serve(lis)</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证"><a href="#通过Google验证" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pool, _ := x509.SystemCertPool()</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">creds := credentials.NewClientTLSFromCert(pool, <span class="string">""</span>)</span><br><span class="line">perRPC, _ := oauth.NewServiceAccountFromFile(<span class="string">"service-account.json"</span>, scope)</span><br><span class="line">conn, _ := grpc.Dial(</span><br><span class="line">	<span class="string">"greeter.googleapis.com"</span>,</span><br><span class="line">	grpc.WithTransportCredentials(creds),</span><br><span class="line">	grpc.WithPerRPCCredentials(perRPC),</span><br><span class="line">)</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">client := pb.NewGreeterClient(conn)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><h4 id="基本情况-无加密或身份验证-1"><a href="#基本情况-无加密或身份验证-1" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stub = Helloworld::Greeter::Stub.new(<span class="string">'localhost:50051'</span>, <span class="symbol">:this_channel_is_insecure</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-1"><a href="#使用服务器身份验证SSL-TLS-1" class="headerlink" title="使用服务器身份验证SSL / TLS"></a>使用服务器身份验证SSL / TLS</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">creds = GRPC::Core::Credentials.new(load_certs)  <span class="comment"># load_certs typically loads a CA roots file</span></span><br><span class="line">stub = Helloworld::Greeter::Stub.new(<span class="string">'myservice.example.com'</span>, creds)</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-1"><a href="#通过Google验证-1" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'googleauth'</span>  <span class="comment"># from http://www.rubydoc.info/gems/googleauth/0.1.0</span></span><br><span class="line">...</span><br><span class="line">ssl_creds = GRPC::Core::ChannelCredentials.new(load_certs)  <span class="comment"># load_certs typically loads a CA roots file</span></span><br><span class="line">authentication = Google::Auth.get_application_default()</span><br><span class="line">call_creds = GRPC::Core::CallCredentials.new(authentication.updater_proc)</span><br><span class="line">combined_creds = ssl_creds.compose(call_creds)</span><br><span class="line">stub = Helloworld::Greeter::Stub.new(<span class="string">'greeter.googleapis.com'</span>, combined_creds)</span><br></pre></td></tr></table></figure>

<h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><h4 id="基本情况-无加密或身份验证-2"><a href="#基本情况-无加密或身份验证-2" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> channel = grpc::CreateChannel(<span class="string">"localhost:50051"</span>, InsecureChannelCredentials());</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Greeter::Stub&gt; stub(Greeter::NewStub(channel));</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-2"><a href="#使用服务器身份验证SSL-TLS-2" class="headerlink" title="使用服务器身份验证SSL / TLS"></a>使用服务器身份验证SSL / TLS</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> channel_creds = grpc::SslCredentials(grpc::SslCredentialsOptions());</span><br><span class="line"><span class="keyword">auto</span> channel = grpc::CreateChannel(<span class="string">"myservice.example.com"</span>, channel_creds);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Greeter::Stub&gt; stub(Greeter::NewStub(channel));</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="A通过Google验证"><a href="#A通过Google验证" class="headerlink" title="A通过Google验证"></a>A通过Google验证</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> creds = grpc::GoogleDefaultCredentials();</span><br><span class="line"><span class="keyword">auto</span> channel = grpc::CreateChannel(<span class="string">"greeter.googleapis.com"</span>, creds);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;Greeter::Stub&gt; stub(Greeter::NewStub(channel));</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="C-1"><a href="#C-1" class="headerlink" title="C#"></a>C#</h3><h4 id="基本情况-无加密或身份验证-3"><a href="#基本情况-无加密或身份验证-3" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> Channel(<span class="string">"localhost:50051"</span>, ChannelCredentials.Insecure);</span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Greeter.GreeterClient(channel);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-3"><a href="#使用服务器身份验证SSL-TLS-3" class="headerlink" title="使用服务器身份验证SSL / TLS"></a>使用服务器身份验证SSL / TLS</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> channelCredentials = <span class="keyword">new</span> SslCredentials(File.ReadAllText(<span class="string">"roots.pem"</span>));  <span class="comment">// Load a custom roots file.</span></span><br><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> Channel(<span class="string">"myservice.example.com"</span>, channelCredentials);</span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Greeter.GreeterClient(channel);</span><br></pre></td></tr></table></figure>

<h4 id="A通过Google验证-1"><a href="#A通过Google验证-1" class="headerlink" title="A通过Google验证"></a>A通过Google验证</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Grpc.Auth;  <span class="comment">// from Grpc.Auth NuGet package</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// Loads Google Application Default Credentials with publicly trusted roots.</span></span><br><span class="line"><span class="keyword">var</span> channelCredentials = <span class="keyword">await</span> GoogleGrpcCredentials.GetApplicationDefaultAsync();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> Channel(<span class="string">"greeter.googleapis.com"</span>, channelCredentials);</span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Greeter.GreeterClient(channel);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="验证单个RPC调用"><a href="#验证单个RPC调用" class="headerlink" title="验证单个RPC调用"></a>验证单个RPC调用</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> Channel(<span class="string">"greeter.googleapis.com"</span>, <span class="keyword">new</span> SslCredentials());  <span class="comment">// Use publicly trusted roots.</span></span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Greeter.GreeterClient(channel);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> googleCredential = <span class="keyword">await</span> GoogleCredential.GetApplicationDefaultAsync();</span><br><span class="line"><span class="keyword">var</span> result = client.SayHello(request, <span class="keyword">new</span> CallOptions(credentials: googleCredential.ToCallCredentials()));</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><h4 id="基本情况-无加密或身份验证-4"><a href="#基本情况-无加密或身份验证-4" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"></span><br><span class="line">channel = grpc.insecure_channel(<span class="string">'localhost:50051'</span>)</span><br><span class="line">stub = helloworld_pb2.GreeterStub(channel)</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-4"><a href="#使用服务器身份验证SSL-TLS-4" class="headerlink" title="使用服务器身份验证SSL / TLS"></a>使用服务器身份验证SSL / TLS</h4><p>客户端:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'roots.pem'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    creds = grpc.ssl_channel_credentials(f.read())</span><br><span class="line">channel = grpc.secure_channel(<span class="string">'myservice.example.com:443'</span>, creds)</span><br><span class="line">stub = helloworld_pb2.GreeterStub(channel)</span><br></pre></td></tr></table></figure>

<p>服务端:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</span><br><span class="line"></span><br><span class="line">server = grpc.server(futures.ThreadPoolExecutor(max_workers=<span class="number">10</span>))</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'key.pem'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    private_key = f.read()</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'chain.pem'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    certificate_chain = f.read()</span><br><span class="line">server_credentials = grpc.ssl_server_credentials( ( (private_key, certificate_chain), ) )</span><br><span class="line"><span class="comment"># Adding GreeterServicer to server omitted</span></span><br><span class="line">server.add_secure_port(<span class="string">'myservice.example.com:443'</span>, server_credentials)</span><br><span class="line">server.start()</span><br><span class="line"><span class="comment"># Server sleep omitted</span></span><br></pre></td></tr></table></figure>

<h4 id="使用JWT与Google进行身份验证"><a href="#使用JWT与Google进行身份验证" class="headerlink" title="使用JWT与Google进行身份验证"></a>使用JWT与Google进行身份验证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> google <span class="keyword">import</span> auth <span class="keyword">as</span> google_auth</span><br><span class="line"><span class="keyword">from</span> google.auth <span class="keyword">import</span> jwt <span class="keyword">as</span> google_auth_jwt</span><br><span class="line"><span class="keyword">from</span> google.auth.transport <span class="keyword">import</span> grpc <span class="keyword">as</span> google_auth_transport_grpc</span><br><span class="line"></span><br><span class="line">credentials, _ = google_auth.default()</span><br><span class="line">jwt_creds = google_auth_jwt.OnDemandCredentials.from_signing_credentials(</span><br><span class="line">    credentials)</span><br><span class="line">channel = google_auth_transport_grpc.secure_authorized_channel(</span><br><span class="line">    jwt_creds, <span class="literal">None</span>, <span class="string">'greeter.googleapis.com:443'</span>)</span><br><span class="line">stub = helloworld_pb2.GreeterStub(channel)</span><br></pre></td></tr></table></figure>

<h4 id="使用Oauth2令牌通过Google进行身份验证"><a href="#使用Oauth2令牌通过Google进行身份验证" class="headerlink" title="使用Oauth2令牌通过Google进行身份验证"></a>使用Oauth2令牌通过Google进行身份验证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> google <span class="keyword">import</span> auth <span class="keyword">as</span> google_auth</span><br><span class="line"><span class="keyword">from</span> google.auth.transport <span class="keyword">import</span> grpc <span class="keyword">as</span> google_auth_transport_grpc</span><br><span class="line"><span class="keyword">from</span> google.auth.transport <span class="keyword">import</span> requests <span class="keyword">as</span> google_auth_transport_requests</span><br><span class="line"></span><br><span class="line">credentials, _ = google_auth.default(scopes=(scope,))</span><br><span class="line">request = google_auth_transport_requests.Request()</span><br><span class="line">channel = google_auth_transport_grpc.secure_authorized_channel(</span><br><span class="line">    credentials, request, <span class="string">'greeter.googleapis.com:443'</span>)</span><br><span class="line">stub = helloworld_pb2.GreeterStub(channel)</span><br></pre></td></tr></table></figure>

<h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><h4 id="基本情况-无加密或身份验证-5"><a href="#基本情况-无加密或身份验证-5" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ManagedChannel channel = ManagedChannelBuilder.forAddress(<span class="string">"localhost"</span>, <span class="number">50051</span>)</span><br><span class="line">    .usePlaintext(<span class="keyword">true</span>)</span><br><span class="line">    .build();</span><br><span class="line">GreeterGrpc.GreeterStub stub = GreeterGrpc.newStub(channel);</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-5"><a href="#使用服务器身份验证SSL-TLS-5" class="headerlink" title="使用服务器身份验证SSL / TLS"></a>使用服务器身份验证SSL / TLS</h4><p>在Java中，我们建议您在使用gRPC over TLS时使用OpenSSL。 您可以在gRPC Java中找到有关安装和使用OpenSSL以及Android和非Android Java所需的其他库的详细信息[安全]（<a href="https://github.com/grpc/grpc-java/blob/master/SECURITY.md" target="_blank" rel="noopener">https://github.com/grpc/grpc-java/blob/master/SECURITY.md</a> #transport-security-tls）文档。</p>
<p>要在服务器上启用TLS，需要以PEM格式指定证书链和私钥。 这样的私钥不应该使用密码。 链中的证书顺序很重要：更具体地说，顶部的证书必须是主机CA，而最底部的证书必须是根CA. 标准TLS端口是443，但我们使用下面的8443以避免需要操作系统的额外权限。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Server server = ServerBuilder.forPort(<span class="number">8443</span>)</span><br><span class="line">    <span class="comment">// Enable TLS</span></span><br><span class="line">    .useTransportSecurity(certChainFile, privateKeyFile)</span><br><span class="line">    .addService(TestServiceGrpc.bindService(serviceImplementation))</span><br><span class="line">    .build();</span><br><span class="line">server.start();</span><br></pre></td></tr></table></figure>

<p>如果客户端不知道颁发证书颁发机构，则应分别向<code>NettyChannelBuilder</code>或<code>OkHttpChannelBuilder</code>提供正确配置的<code>SslContext</code>或<code>SSLSocketFactory</code>。</p>
<p>在客户端，使用SSL / TLS的服务器身份验证如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// With server authentication SSL/TLS</span></span><br><span class="line">ManagedChannel channel = ManagedChannelBuilder.forAddress(<span class="string">"myservice.example.com"</span>, <span class="number">443</span>)</span><br><span class="line">    .build();</span><br><span class="line">GreeterGrpc.GreeterStub stub = GreeterGrpc.newStub(channel);</span><br><span class="line"></span><br><span class="line"><span class="comment">// With server authentication SSL/TLS; custom CA root certificates; not on Android</span></span><br><span class="line">ManagedChannel channel = NettyChannelBuilder.forAddress(<span class="string">"myservice.example.com"</span>, <span class="number">443</span>)</span><br><span class="line">    .sslContext(GrpcSslContexts.forClient().trustManager(<span class="keyword">new</span> File(<span class="string">"roots.pem"</span>)).build())</span><br><span class="line">    .build();</span><br><span class="line">GreeterGrpc.GreeterStub stub = GreeterGrpc.newStub(channel);</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-2"><a href="#通过Google验证-2" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><p>The following code snippet shows how you can call the <a href="https://cloud.google.com/pubsub/overview" target="_blank" rel="noopener">Google Cloud PubSub API</a> using gRPC with a service account. The credentials are loaded from a key stored in a well-known location or by detecting that the application is running in an environment that can provide one automatically, e.g. Google Compute Engine. While this example is specific to Google and its services, similar patterns can be followed for other service providers.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GoogleCredentials creds = GoogleCredentials.getApplicationDefault();</span><br><span class="line">ManagedChannel channel = ManagedChannelBuilder.forTarget(<span class="string">"greeter.googleapis.com"</span>)</span><br><span class="line">    .build();</span><br><span class="line">GreeterGrpc.GreeterStub stub = GreeterGrpc.newStub(channel)</span><br><span class="line">    .withCallCredentials(MoreCallCredentials.from(creds));</span><br></pre></td></tr></table></figure>

<h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><h4 id="基本情况-无加密或身份验证-6"><a href="#基本情况-无加密或身份验证-6" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stub = <span class="keyword">new</span> helloworld.Greeter(<span class="string">'localhost:50051'</span>, grpc.credentials.createInsecure());</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-6"><a href="#使用服务器身份验证SSL-TLS-6" class="headerlink" title="使用服务器身份验证SSL / TLS"></a>使用服务器身份验证SSL / TLS</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ssl_creds = grpc.credentials.createSsl(root_certs);</span><br><span class="line"><span class="keyword">var</span> stub = <span class="keyword">new</span> helloworld.Greeter(<span class="string">'myservice.example.com'</span>, ssl_creds);</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-3"><a href="#通过Google验证-3" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Authenticating with Google</span></span><br><span class="line"><span class="keyword">var</span> GoogleAuth = <span class="built_in">require</span>(<span class="string">'google-auth-library'</span>); <span class="comment">// from https://www.npmjs.com/package/google-auth-library</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> ssl_creds = grpc.credentials.createSsl(root_certs);</span><br><span class="line">(<span class="keyword">new</span> GoogleAuth()).getApplicationDefault(<span class="function"><span class="keyword">function</span>(<span class="params">err, auth</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> call_creds = grpc.credentials.createFromGoogleCredential(auth);</span><br><span class="line">  <span class="keyword">var</span> combined_creds = grpc.credentials.combineChannelCredentials(ssl_creds, call_creds);</span><br><span class="line">  <span class="keyword">var</span> stub = <span class="keyword">new</span> helloworld.Greeter(<span class="string">'greeter.googleapis.com'</span>, combined_credentials);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="使用Oauth2令牌使用Google进行身份验证（传统方法）"><a href="#使用Oauth2令牌使用Google进行身份验证（传统方法）" class="headerlink" title="使用Oauth2令牌使用Google进行身份验证（传统方法）"></a>使用Oauth2令牌使用Google进行身份验证（传统方法）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> GoogleAuth = <span class="built_in">require</span>(<span class="string">'google-auth-library'</span>); <span class="comment">// from https://www.npmjs.com/package/google-auth-library</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> ssl_creds = grpc.Credentials.createSsl(root_certs); <span class="comment">// load_certs typically loads a CA roots file</span></span><br><span class="line"><span class="keyword">var</span> scope = <span class="string">'https://www.googleapis.com/auth/grpc-testing'</span>;</span><br><span class="line">(<span class="keyword">new</span> GoogleAuth()).getApplicationDefault(<span class="function"><span class="keyword">function</span>(<span class="params">err, auth</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (auth.createScopeRequired()) &#123;</span><br><span class="line">    auth = auth.createScoped(scope);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> call_creds = grpc.credentials.createFromGoogleCredential(auth);</span><br><span class="line">  <span class="keyword">var</span> combined_creds = grpc.credentials.combineChannelCredentials(ssl_creds, call_creds);</span><br><span class="line">  <span class="keyword">var</span> stub = <span class="keyword">new</span> helloworld.Greeter(<span class="string">'greeter.googleapis.com'</span>, combined_credentials);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><h4 id="基本情况-无加密或身份验证-7"><a href="#基本情况-无加密或身份验证-7" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$client = <span class="keyword">new</span> helloworld\GreeterClient(<span class="string">'localhost:50051'</span>, [</span><br><span class="line">    <span class="string">'credentials'</span> =&gt; Grpc\ChannelCredentials::createInsecure(),</span><br><span class="line">]);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-4"><a href="#通过Google验证-4" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateAuthMetadataCallback</span><span class="params">($context)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $auth_credentials = ApplicationDefaultCredentials::getCredentials();</span><br><span class="line">    <span class="keyword">return</span> $auth_credentials-&gt;updateMetadata($metadata = [], $context-&gt;service_url);</span><br><span class="line">&#125;</span><br><span class="line">$channel_credentials = Grpc\ChannelCredentials::createComposite(</span><br><span class="line">    Grpc\ChannelCredentials::createSsl(file_get_contents(<span class="string">'roots.pem'</span>)),</span><br><span class="line">    Grpc\CallCredentials::createFromPlugin(<span class="string">'updateAuthMetadataCallback'</span>)</span><br><span class="line">);</span><br><span class="line">$opts = [</span><br><span class="line">  <span class="string">'credentials'</span> =&gt; $channel_credentials</span><br><span class="line">];</span><br><span class="line">$client = <span class="keyword">new</span> helloworld\GreeterClient(<span class="string">'greeter.googleapis.com'</span>, $opts);</span><br></pre></td></tr></table></figure>

<h4 id="使用Oauth2令牌使用Google进行身份验证（传统方法）-1"><a href="#使用Oauth2令牌使用Google进行身份验证（传统方法）-1" class="headerlink" title="使用Oauth2令牌使用Google进行身份验证（传统方法）"></a>使用Oauth2令牌使用Google进行身份验证（传统方法）</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the environment variable "GOOGLE_APPLICATION_CREDENTIALS" needs to be set</span></span><br><span class="line">$scope = <span class="string">"https://www.googleapis.com/auth/grpc-testing"</span>;</span><br><span class="line">$auth = Google\Auth\ApplicationDefaultCredentials::getCredentials($scope);</span><br><span class="line">$opts = [</span><br><span class="line">  <span class="string">'credentials'</span> =&gt; Grpc\Credentials::createSsl(file_get_contents(<span class="string">'roots.pem'</span>));</span><br><span class="line">  <span class="string">'update_metadata'</span> =&gt; $auth-&gt;getUpdateMetadataFunc(),</span><br><span class="line">];</span><br><span class="line">$client = <span class="keyword">new</span> helloworld\GreeterClient(<span class="string">'greeter.googleapis.com'</span>, $opts);</span><br></pre></td></tr></table></figure>

<h3 id="Dart"><a href="#Dart" class="headerlink" title="Dart"></a>Dart</h3><h4 id="基本情况-无加密或身份验证-8"><a href="#基本情况-无加密或身份验证-8" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> channel = <span class="keyword">new</span> ClientChannel(<span class="string">'localhost'</span>,</span><br><span class="line">      port: <span class="number">50051</span>,</span><br><span class="line">      options: <span class="keyword">const</span> ChannelOptions(</span><br><span class="line">          credentials: <span class="keyword">const</span> ChannelCredentials.insecure()));</span><br><span class="line"><span class="keyword">final</span> stub = <span class="keyword">new</span> GreeterClient(channel);</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-7"><a href="#使用服务器身份验证SSL-TLS-7" class="headerlink" title="使用服务器身份验证SSL / TLS"></a>使用服务器身份验证SSL / TLS</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Load a custom roots file.</span></span><br><span class="line"><span class="keyword">final</span> trustedRoot = <span class="keyword">new</span> File(<span class="string">'roots.pem'</span>).readAsBytesSync();</span><br><span class="line"><span class="keyword">final</span> channelCredentials =</span><br><span class="line">    <span class="keyword">new</span> ChannelCredentials.secure(certificates: trustedRoot);</span><br><span class="line"><span class="keyword">final</span> channelOptions = <span class="keyword">new</span> ChannelOptions(credentials: channelCredentials);</span><br><span class="line"><span class="keyword">final</span> channel = <span class="keyword">new</span> ClientChannel(<span class="string">'myservice.example.com'</span>,</span><br><span class="line">    options: channelOptions);</span><br><span class="line"><span class="keyword">final</span> client = <span class="keyword">new</span> GreeterClient(channel);</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-5"><a href="#通过Google验证-5" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Uses publicly trusted roots by default.</span></span><br><span class="line"><span class="keyword">final</span> channel = <span class="keyword">new</span> ClientChannel(<span class="string">'greeter.googleapis.com'</span>);</span><br><span class="line"><span class="keyword">final</span> serviceAccountJson =</span><br><span class="line">     <span class="keyword">new</span> File(<span class="string">'service-account.json'</span>).readAsStringSync();</span><br><span class="line"><span class="keyword">final</span> credentials = <span class="keyword">new</span> JwtServiceAccountAuthenticator(serviceAccountJson);</span><br><span class="line"><span class="keyword">final</span> client =</span><br><span class="line">    <span class="keyword">new</span> GreeterClient(channel, options: credentials.toCallOptions);</span><br></pre></td></tr></table></figure>

<h4 id="验证单个RPC调用-1"><a href="#验证单个RPC调用-1" class="headerlink" title="验证单个RPC调用"></a>验证单个RPC调用</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Uses publicly trusted roots by default.</span></span><br><span class="line"><span class="keyword">final</span> channel = <span class="keyword">new</span> ClientChannel(<span class="string">'greeter.googleapis.com'</span>);</span><br><span class="line"><span class="keyword">final</span> client = <span class="keyword">new</span> GreeterClient(channel);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">final</span> serviceAccountJson =</span><br><span class="line">     <span class="keyword">new</span> File(<span class="string">'service-account.json'</span>).readAsStringSync();</span><br><span class="line"><span class="keyword">final</span> credentials = <span class="keyword">new</span> JwtServiceAccountAuthenticator(serviceAccountJson);</span><br><span class="line"><span class="keyword">final</span> response =</span><br><span class="line">    <span class="keyword">await</span> client.sayHello(request, options: credentials.toCallOptions);</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:null">Wang YangYang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://wangyangyangisme.github.io/2019/09/27/grpc-grpc-%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/">http://wangyangyangisme.github.io/2019/09/27/grpc-grpc-%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://wangyangyangisme.github.io" target="_blank">WangYangYang</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=null" async="async"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/donat/76bc52296bcf2e0b7a1d628106ffcd52.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/donat/fab2285fdcd13ead0a8b4a853c659d03.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/09/27/grpc-grpc-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%92%8C%E8%B0%83%E8%AF%95/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/grpc/e176d51922d5f883ec368af51ca6ec9b.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">grpc-错误处理和调试</div></div></a></div><div class="next-post pull_right"><a href="/2019/09/27/grpc-grpc-%E6%A6%82%E5%BF%B5/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/grpc/69a889d02bd1240d25ce8ba4d8ea084a.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">grpc-概念</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: true,
  verify: false,
  appId: '49gEIIGN7uRbL6vHhieSpBzM-MdYXbMMI',
  appKey: 'uqts0urLKwikYQ0fKmIkMHBE',
  placeholder: '请留下你的脚印',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Wang YangYang</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://wangyangyangisme.github.io/">blog</a>!</div><div class="icp"><a><img class="icp-icon" src="/img/icp.png"/><span></span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/click_heart.js"></script><script src="/js/search/algolia.js"></script></body></html>