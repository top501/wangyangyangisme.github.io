<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>NATS Streaming | WangYangYang</title><meta name="description" content="NATS Streaming"><meta name="author" content="Wang YangYang"><meta name="copyright" content="Wang YangYang"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/theme/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="NATS Streaming"><meta name="twitter:description" content="NATS Streaming"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/95994a9aea31be452e66c89e68ba4a27.jpg"><meta property="og:type" content="article"><meta property="og:title" content="NATS Streaming"><meta property="og:url" content="http://wangyangyangisme.github.io/2019/09/27/nats-NATS-Streaming/"><meta property="og:site_name" content="WangYangYang"><meta property="og:description" content="NATS Streaming"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/95994a9aea31be452e66c89e68ba4a27.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      now = new Date();
      hour = now.getHours();
      isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://wangyangyangisme.github.io/2019/09/27/nats-NATS-Streaming/"><link rel="prev" title="NATS和NATS Streaming" href="http://wangyangyangisme.github.io/2019/09/27/nats-NATS%E5%92%8CNATS%20Streaming%E4%BD%BF%E7%94%A8/"><link rel="next" title="Nats管理服务器" href="http://wangyangyangisme.github.io/2019/09/27/nats-NATS-%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"C4QN4OTLJM","apiKey":"c2c026ba64eeb77abd2164975fa41f34","indexName":"wyy","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://wangyangyangisme.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: false,
  isFontAwesomeV5: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/theme/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">188</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">19</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">37</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movie/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NATS-Streaming"><span class="toc-text">NATS Streaming</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS-Streaming-概念"><span class="toc-text">NATS Streaming 概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特点"><span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用法，配置和管理"><span class="toc-text">用法，配置和管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装NATS-Streaming-Server"><span class="toc-text">安装NATS Streaming Server</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装并运行NATS-Streaming-Server"><span class="toc-text">安装并运行NATS Streaming Server</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装NATS-Streaming服务器"><span class="toc-text">安装NATS Streaming服务器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS-Streaming入门"><span class="toc-text">NATS Streaming入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#先决条件"><span class="toc-text">先决条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-1"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启动NATS-Streaming-Server"><span class="toc-text">启动NATS Streaming Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行发布者客户端"><span class="toc-text">运行发布者客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行订户客户端"><span class="toc-text">运行订户客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#探索其他订阅选项"><span class="toc-text">探索其他订阅选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS流媒体服务器安全"><span class="toc-text">NATS流媒体服务器安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#验证用户"><span class="toc-text">验证用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用TLS"><span class="toc-text">使用TLS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS-Streaming-Protocol"><span class="toc-text">NATS Streaming Protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NATS-streaming-protocol-conventions"><span class="toc-text">NATS streaming protocol conventions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NATS-streaming-protocol-messages"><span class="toc-text">NATS streaming protocol messages</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConnectRequest"><span class="toc-text">ConnectRequest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConnectResponse"><span class="toc-text">ConnectResponse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SubscriptionRequest"><span class="toc-text">SubscriptionRequest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SubscriptionResponse"><span class="toc-text">SubscriptionResponse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UnsubscribeRequest"><span class="toc-text">UnsubscribeRequest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PubMsg"><span class="toc-text">PubMsg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PubAck"><span class="toc-text">PubAck</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MsgProto"><span class="toc-text">MsgProto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ack"><span class="toc-text">Ack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CloseRequest"><span class="toc-text">CloseRequest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CloseResponse"><span class="toc-text">CloseResponse</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/95994a9aea31be452e66c89e68ba4a27.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">WangYangYang</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movie/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">NATS Streaming</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-09-27<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-11-06</time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/nats/">nats</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">4.2k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 19 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2019/09/27/nats-NATS-Streaming/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2019/09/27/nats-NATS-Streaming/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="NATS-Streaming"><a href="#NATS-Streaming" class="headerlink" title="NATS Streaming"></a>NATS Streaming</h1><h2 id="NATS-Streaming-概念"><a href="#NATS-Streaming-概念" class="headerlink" title="NATS Streaming 概念"></a>NATS Streaming 概念</h2><p>NATS Streaming是一个由NATS驱动的数据流系统，用Go编程语言编写。 NATS Streaming服务器的可执行文件名是<a href="https://github.com/nats-io/nats-streaming-server" target="_blank" rel="noopener">nats-streaming-server</a>。 NATS Streaming与核心NATS平台无缝嵌入，扩展和互操作。 NATS Streaming服务器作为Apache-2.0许可下的开源软件提供。 Synadia积极维护和支持NATS Streaming服务器。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>除了核心NATS平台的功能外，NATS Streaming还提供以下功能：</p>
<ul>
<li>增强的消息协议 - NATS Streaming使用谷歌协议缓冲区实现自己的增强型消息格式。这些消息通过二进制数据流在NATS核心平台进行传播,因此不需要改变NATS的基本协议。NATS Streaming信息包含以下字段:<ul>
<li>序列 - 一个全局顺序序列号为主题的通道<br>　　- 主题 - 是NATS Streaming 交付对象<br>　　- 答复内容 - 对应”reply-to”对应的对象内容<br>　　- 数据 - 真是数据内容<br>　　- 时间戳 - 接收的时间戳，单位是纳秒<br>　　- 重复发送 - 标志这条数据是否需要服务再次发送<br>　　- CRC32 - 一个循环冗余数据校验选项，在数据存储和数据通讯领域里，为了保证数据的正确性所采用的检错手段，这里使用的是 IEEE CRC32 算法</li>
</ul>
</li>
<li>消息/事件持久性 - NATS Streaming提供了可配置的消息持久化，持久目的地可以为内存或者文件。另外，对应的存储子系统使用了一个公共接口允许我们开发自己自定义实现来持久化对应的消息。</li>
<li>至少一次传送 - NATS Streaming提供了发布者和服务器之间的消息确认(发布操作) 和订阅者和服务器之间的消息确认(确认消息发送)。其中消息被保存在服务器端内存或者辅助存储(或其他外部存储器)用来为需要重新接受消息的订阅者进行重发消息。</li>
<li>发布者发送速率限定 - NATS Streaming提供了一个连接选项叫 MaxPubAcksInFlight，它能有效的限制一个发布者可能随意的在任何时候发送的未被确认的消息。当达到这个配置的最大数量时，异步发送调用接口将会被阻塞，直到未确认消息降到指定数量之下。</li>
<li>每个订户的速率匹配/限制 - NATS Streaming运行指定的订阅中设置一个参数为 MaxInFlight，它用来指定已确认但未消费的最大数据量，当达到这个限制时，NATS Streaming 将暂停发送消息给订阅者，直到未确认的数据量小于设定的量为止。</li>
<li>以主题重发的历史数据 - 新订阅的可以在已经存储起来的订阅的主题频道指定起始位置消息流。通过使用这个选项,消息就可以开始发送传递了:<ul>
<li>订阅的主题存储的最早的信息</li>
<li>与当前订阅主题之前的最近存储的数据，这通常被认为是 “最后的值” 或 “初值” 对应的缓存</li>
<li>一个以纳秒为基准的 日期／时间</li>
<li>一个历史的起始位置相对当前服务的 日期／时间，例如：最后30秒</li>
<li>一个特定的消息序列号</li>
</ul>
</li>
<li>持久订阅 - 订阅也可以指定一个“持久化的名称”可以在客户端重启时不受影响。持久订阅会使得对应服务跟踪客户端最后确认消息的序列号和持久名称。当这个客户端重启或者重新订阅的时候，使用相同的客户端ID 和 持久化的名称，对应的服务将会从最早的未被确认的消息处恢复。</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>NATS为Linux，Mac和Windows提供服务器<a href="https://www.nats.io/documentation/streaming/nats-streaming-install/" target="_blank" rel="noopener">二进制文件</a>。您可以在您选择的任何平台上从源安装服务器。</p>
<h3 id="用法，配置和管理"><a href="#用法，配置和管理" class="headerlink" title="用法，配置和管理"></a>用法，配置和管理</h3><p>NATS Streaming提供了一组丰富的命令和参数来配置服务器的所有方面。有关使用，配置和管理的更多信息，请参阅<a href="https://github.com/nats-io/nats-streaming-server/" target="_blank" rel="noopener">自述文件</a>。</p>
<h2 id="安装NATS-Streaming-Server"><a href="#安装NATS-Streaming-Server" class="headerlink" title="安装NATS Streaming Server"></a>安装NATS Streaming Server</h2><h3 id="安装并运行NATS-Streaming-Server"><a href="#安装并运行NATS-Streaming-Server" class="headerlink" title="安装并运行NATS Streaming Server"></a>安装并运行NATS Streaming Server</h3><p>在本教程中，您将安装并运行NATS Streaming服务器（nats-streaming-server）。您可以在任何时候运行NATS Streaming服务器时遵循相同的过程。</p>
<h4 id="安装NATS-Streaming服务器"><a href="#安装NATS-Streaming服务器" class="headerlink" title="安装NATS Streaming服务器"></a>安装NATS Streaming服务器</h4><p>有许多方法可以安装NATS Streaming服务器。<br><strong>GitHub发布</strong></p>
<p>GitHub版本页面上始终提供最新的官方发行版二进制文件。可以使用以下平台：</p>
<ul>
<li>Linux (x86, x86_64, ARM)</li>
<li>Windows (x86, x86_64)</li>
<li>macOS</li>
</ul>
<p>也可以使用以下方法。请注意，这些方法可能无法安装最新发布的版本：<br><strong>Go</strong></p>
<p>确保设置了Go环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> go get github.com/nats-io/nats-streaming-server</span></span><br></pre></td></tr></table></figure>

<p>请注意，此方法可能无法安装最新发布的版本。<br><strong>Docker Hub</strong></p>
<p>Docker Hub上始终提供最新的官方<a href="https://hub.docker.com/_/nats-streaming/" target="_blank" rel="noopener">Docker映像</a>。</p>
<p><strong>Windows</strong></p>
<p>在Windows上，也可以通过Chocolatey安装NATS Streaming服务器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> choco install nats-streaming-server</span></span><br></pre></td></tr></table></figure>

<p><strong>macOS</strong></p>
<p>在macOS上，可以通过Homebrew安装NATS Streaming服务器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> brew install nats-streaming-server</span></span><br></pre></td></tr></table></figure>

<p><strong>启动NATS Streaming服务器</strong></p>
<p>您可以调用NATS Streaming服务器二进制文件，没有选项，也没有配置文件，以启动具有可接受的独立默认值的服务器（无身份验证，无群集）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> nats-streaming-server</span></span><br></pre></td></tr></table></figure>

<p>当服务器成功启动时，您将看到NATS Streaming服务器在TCP端口4222上侦听客户端连接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[18085] 2016/10/31 13:11:44.059012 [INF] Starting nats-streaming-server[test-cluster] version 0.3.1</span><br><span class="line">[18085] 2016/10/31 13:11:44.059830 [INF] Starting nats-server version 0.9.4</span><br><span class="line">[18085] 2016/10/31 13:11:44.061544 [INF] Listening for client connections on 0.0.0.0:4222</span><br><span class="line">[18085] 2016/10/31 13:11:44.061966 [INF] Server is ready</span><br><span class="line">[18085] 2016/10/31 13:11:44.396819 [INF] STAN: Message store is MEMORY</span><br><span class="line">[18085] 2016/10/31 13:11:44.396832 [INF] STAN: --------- Store Limits ---------</span><br><span class="line">[18085] 2016/10/31 13:11:44.396837 [INF] STAN: Channels:                  100 *</span><br><span class="line">[18085] 2016/10/31 13:11:44.396839 [INF] STAN: -------- channels limits -------</span><br><span class="line">[18085] 2016/10/31 13:11:44.396842 [INF] STAN:   Subscriptions:          1000 *</span><br><span class="line">[18085] 2016/10/31 13:11:44.396844 [INF] STAN:   Messages     :       1000000 *</span><br><span class="line">[18085] 2016/10/31 13:11:44.396855 [INF] STAN:   Bytes        :     976.56 MB *</span><br><span class="line">[18085] 2016/10/31 13:11:44.396858 [INF] STAN:   Age          :     unlimited *</span><br><span class="line">[18085] 2016/10/31 13:11:44.396859 [INF] STAN: --------------------------------</span><br></pre></td></tr></table></figure>



<p><strong>启用NATS监控启动NATS流服务器（可选）</strong></p>
<p>NATS Streaming服务器在端口8222上公开其嵌入式NATS服务器（nats-server）的监视接口。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> nats-streaming-server -m 8222</span></span><br></pre></td></tr></table></figure>

<p>如果在启用监视的情况下运行NATS Streaming服务器，则会看到以下消息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[18122] 2016/10/31 13:13:10.048663 [INF] Starting nats-streaming-server[test-cluster] version 0.3.1</span><br><span class="line">[18122] 2016/10/31 13:13:10.048843 [INF] Starting nats-server version 0.9.4</span><br><span class="line">[18122] 2016/10/31 13:13:10.048890 [INF] Starting http monitor on 0.0.0.0:8222</span><br><span class="line">[18122] 2016/10/31 13:13:10.048968 [INF] Listening for client connections on 0.0.0.0:4222</span><br><span class="line">[18122] 2016/10/31 13:13:10.048992 [INF] Server is ready</span><br><span class="line">[18122] 2016/10/31 13:13:10.388282 [INF] STAN: Message store is MEMORY</span><br><span class="line">[18122] 2016/10/31 13:13:10.388301 [INF] STAN: --------- Store Limits ---------</span><br><span class="line">[18122] 2016/10/31 13:13:10.388309 [INF] STAN: Channels:                  100 *</span><br><span class="line">[18122] 2016/10/31 13:13:10.388312 [INF] STAN: -------- channels limits -------</span><br><span class="line">[18122] 2016/10/31 13:13:10.388316 [INF] STAN:   Subscriptions:          1000 *</span><br><span class="line">[18122] 2016/10/31 13:13:10.388319 [INF] STAN:   Messages     :       1000000 *</span><br><span class="line">[18122] 2016/10/31 13:13:10.388333 [INF] STAN:   Bytes        :     976.56 MB *</span><br><span class="line">[18122] 2016/10/31 13:13:10.388338 [INF] STAN:   Age          :     unlimited *</span><br><span class="line">[18122] 2016/10/31 13:13:10.388341 [INF] STAN: --------------------------------</span><br></pre></td></tr></table></figure>

<h2 id="NATS-Streaming入门"><a href="#NATS-Streaming入门" class="headerlink" title="NATS Streaming入门"></a>NATS Streaming入门</h2><p>本教程使用示例Go NATS Streaming客户端演示NATS Streaming。</p>
<h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><ul>
<li><a href="https://help.github.com/articles/set-up-git/" target="_blank" rel="noopener">设置你的Git环境</a></li>
<li><a href="https://golang.org/doc/install" target="_blank" rel="noopener">设置Go环境</a></li>
</ul>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>下载并安装<a href="https://github.com/nats-io/nats-streaming-server/releases" target="_blank" rel="noopener">NATS Streaming Server</a>。</p>
<p>克隆以下存储库：</p>
<ul>
<li>NATS Streaming Server: <code>git clone https://github.com/nats-io/nats-streaming-server.git</code></li>
<li>NATS Streaming Client: <code>git clone https://github.com/nats-io/go-nats-streaming.git</code></li>
</ul>
<h3 id="启动NATS-Streaming-Server"><a href="#启动NATS-Streaming-Server" class="headerlink" title="启动NATS Streaming Server"></a>启动NATS Streaming Server</h3><p>两种选择：</p>
<p>运行您下载的二进制文件，例如：$ ./nats-streaming-server</p>
<p>或者，从源代码运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/nats-io/nats-streaming-server</span></span><br><span class="line"><span class="meta">%</span><span class="bash"> go run nats-streaming-server.go</span></span><br></pre></td></tr></table></figure>

<p>您应该看到以下内容，表明NATS Streaming Server正在运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> go run nats-streaming-server.go</span></span><br><span class="line">[89999] 2016/06/25 08:54:35.399071 [INF] Starting nats-streaming-server[test-cluster] version 0.1.0</span><br><span class="line">[89999] 2016/06/25 08:54:35.399315 [INF] Starting nats-server version 0.9.0.beta</span><br><span class="line">[89999] 2016/06/25 08:54:35.399326 [INF] Listening for client connections on localhost:4222</span><br><span class="line">[89999] 2016/06/25 08:54:35.400721 [INF] Server is ready</span><br><span class="line">[89999] 2016/06/25 08:54:35.737589 [INF] STAN: Message store is MEMORY</span><br><span class="line">[89999] 2016/06/25 08:54:35.737610 [INF] STAN: Maximum of 1000000 will be stored</span><br></pre></td></tr></table></figure>

<h3 id="运行发布者客户端"><a href="#运行发布者客户端" class="headerlink" title="运行发布者客户端"></a>运行发布者客户端</h3><p>发布多条消息。对于每个出版物，您应该得到一个结果。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/nats-io/go-nats-streaming/examples/stan-pub</span></span><br><span class="line"><span class="meta">%</span><span class="bash"> go run main.go foo <span class="string">"msg one"</span></span></span><br><span class="line">Published [foo] : 'msg one'</span><br><span class="line"><span class="meta">%</span><span class="bash"> go run main.go foo <span class="string">"msg two"</span></span></span><br><span class="line">Published [foo] : 'msg two'</span><br><span class="line"><span class="meta">%</span><span class="bash"> go run main.go foo <span class="string">"msg three"</span></span></span><br><span class="line">Published [foo] : 'msg three'</span><br></pre></td></tr></table></figure>

<h3 id="运行订户客户端"><a href="#运行订户客户端" class="headerlink" title="运行订户客户端"></a>运行订户客户端</h3><p>使用<code>--all</code>标志接收所有已发布的消息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/nats-io/go-nats-streaming/examples/stan-sub</span></span><br><span class="line"><span class="meta">%</span><span class="bash"> go run main.go --all -c <span class="built_in">test</span>-cluster -id myID foo</span></span><br><span class="line">Connected to nats://localhost:4222 clusterID: [test-cluster] clientID: [myID]</span><br><span class="line">subscribing with DeliverAllAvailable</span><br><span class="line">Listening on [foo], clientID=[myID], qgroup=[] durable=[]</span><br><span class="line"><span class="meta">[#</span><span class="bash">1] Received on [foo]: <span class="string">'sequence:1 subject:"foo" data:"msg one" timestamp:1465962202884478817 '</span></span></span><br><span class="line"><span class="meta">[#</span><span class="bash">2] Received on [foo]: <span class="string">'sequence:2 subject:"foo" data:"msg two" timestamp:1465962208545003897 '</span></span></span><br><span class="line"><span class="meta">[#</span><span class="bash">3] Received on [foo]: <span class="string">'sequence:3 subject:"foo" data:"msg three" timestamp:1465962215567601196</span></span></span><br></pre></td></tr></table></figure>

<h3 id="探索其他订阅选项"><a href="#探索其他订阅选项" class="headerlink" title="探索其他订阅选项"></a>探索其他订阅选项</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--seq &lt;seqno&gt;       Start at seqno</span><br><span class="line">--all               Deliver all available messages</span><br><span class="line">--last              Deliver starting with last published message</span><br><span class="line">--since &lt;duration&gt;  Deliver messages in last interval (e.g. 1s, 1hr, https://golang.org/pkg/time/#ParseDuration)</span><br><span class="line">--durable &lt;name&gt;    Durable subscriber name</span><br><span class="line">--unsubscribe       Unsubscribe the durable on exit</span><br></pre></td></tr></table></figure>

<h2 id="NATS流媒体服务器安全"><a href="#NATS流媒体服务器安全" class="headerlink" title="NATS流媒体服务器安全"></a>NATS流媒体服务器安全</h2><h3 id="验证用户"><a href="#验证用户" class="headerlink" title="验证用户"></a>验证用户</h3><p>要从命令行启用用户身份验证，可以使用与NATS服务器（nats-server）相同的机制。您传入-user <user>和-pass <pass>命令或–auth参数，NATS流服务器将自动使用这些凭据。或者，您可以将配置文件与单个用户或令牌一起使用。</p>
<p>使用具有多用户授权的配置文件时，必须将-user和-pass参数与NATS流服务器一起使用，与配置文件中的用户匹配，以指定NATS流服务器应对其进行身份验证的用户。嵌入式NATS服务器。</p>
<p>例如，如果您向NATS流媒体服务器传递包含多个用户的文件，则必须以配置文件中定义的“Joe”等用户身份运行流服务器。</p>
<h3 id="使用TLS"><a href="#使用TLS" class="headerlink" title="使用TLS"></a>使用TLS</h3><p>虽然NATS Streaming服务器有几个与TLS相关的参数，但保护服务器的连接非常简单。但是，请记住，NATS Streaming服务器嵌入NATS服务器，从而产生客户端 - 服务器关系，其中NATS Streaming服务器是其嵌入式NATS服务器的客户端。</p>
<p>这意味着必须使用两组TLS配置参数：嵌入式NATS服务器的TLS服务器参数，以及NATS流服务器本身的TLS客户端参数。</p>
<p>流服务器使用以下三个参数指定它的TLS客户端证书：</p>
<ul>
<li>-tls_client_key流服务器的客户端密钥</li>
<li>-tls_client_cert流服务器的客户端证书</li>
<li>-tls_client_cacert流媒体服务器的客户端证书CA.</li>
</ul>
<p>这些可能与您的NATS流媒体客户端使用的证书相同。</p>
<p>嵌入式NATS服务器使用以下命令指定TLS服务器证书：</p>
<ul>
<li>–tlscert <file>服务器证书文件</li>
<li>–tlskey <file>服务器证书的私钥</li>
<li>–tlscacert <file>用于验证的客户端证书CA.</li>
</ul>
<p>服务器参数的使用方法与安全典型NATS服务器的方式相同。</p>
<p>正确使用NATS Streaming Server需要使用客户端和服务器参数。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash"> nats-streaming-server -tls_client_cert client-cert.pem -tls_client_key client-key.pem -tls_client_cacert ca.pem -tlscert server-cert.pem -tlskey server-key.pem -tlscacert ca.pem</span></span><br></pre></td></tr></table></figure>

<p>进一步的TLS相关功能可以在Securing NATS&gt; TLS中找到。请注意，如果需要指定密码套件，则可以通过<code>-config</code>命令行参数传递嵌入式NATS服务器的配置文件。</p>
<h2 id="NATS-Streaming-Protocol"><a href="#NATS-Streaming-Protocol" class="headerlink" title="NATS Streaming Protocol"></a>NATS Streaming Protocol</h2><p>The NATS streaming protocol sits atop the core <a href="https://www.nats.io/documentation/internals/nats-protocol" target="_blank" rel="noopener">NATS protocol</a> and uses <a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="noopener">Google’s Protocol Buffers</a>.  Protocol buffer messages are marshaled into bytes and published as NATS  messages on specific subjects described below. In communicating with  the NATS Streaming Server, the NATS <a href="https://www.nats.io/documentation/writing_applications/concepts" target="_blank" rel="noopener">request/reply</a> pattern is used for all protocol messages that have a corresponding reply.</p>
<h3 id="NATS-streaming-protocol-conventions"><a href="#NATS-streaming-protocol-conventions" class="headerlink" title="NATS streaming protocol conventions"></a>NATS streaming protocol conventions</h3><p><strong>Subject names</strong>:  Subject names, including reply subject (INBOX) names, are  case-sensitive and must be non-empty alphanumeric strings with no  embedded whitespace, and optionally token-delimited using the dot  character (<code>.</code>), e.g.:</p>
<p><code>FOO</code>, <code>BAR</code>, <code>foo.bar</code>, <code>foo.BAR</code>, <code>FOO.BAR</code> and <code>FOO.BAR.BAZ</code> are all valid subject names</p>
<p><code>FOO. BAR</code>, <code>foo. .bar</code> and<code>foo..bar</code> are *not- valid subject names</p>
<p><strong>Wildcards</strong>: NATS streaming does <em>*not</em>- support wildcards in subject subscriptions</p>
<p><strong>Protocol definition</strong>: The fields of NATS streaming protocol messages are defined in the go-nats-streaming <a href="https://github.com/nats-io/go-nats-streaming/blob/master/pb/protocol.proto" target="_blank" rel="noopener">protocol file</a>.</p>
<h3 id="NATS-streaming-protocol-messages"><a href="#NATS-streaming-protocol-messages" class="headerlink" title="NATS streaming protocol messages"></a>NATS streaming protocol messages</h3><p>The following table briefly describes the NATS streaming protocol messages.</p>
<p>Click the name to see more detailed information, including usage:</p>
<table>
<thead>
<tr>
<th>Message Name</th>
<th>Sent By</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CONNREQ" target="_blank" rel="noopener"><code>ConnectRequest</code></a></td>
<td>Client</td>
<td>Request to connect to the NATS Streaming Server</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CONNRESP" target="_blank" rel="noopener"><code>ConnectResponse</code></a></td>
<td>Server</td>
<td>Result of a connection request</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#SUBREQ" target="_blank" rel="noopener"><code>SubscriptionRequest</code></a></td>
<td>Client</td>
<td>Request sent to subscribe and retrieve data</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#SUBRESP" target="_blank" rel="noopener"><code>SubscriptionResponse</code></a></td>
<td>Server</td>
<td>Result of a subscription request</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#UNSUBREQ" target="_blank" rel="noopener"><code>UnsubscribeRequest</code></a></td>
<td>Client</td>
<td>Unsubscribe from a subject</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#PUBMSG" target="_blank" rel="noopener"><code>PubMsg</code></a></td>
<td>Client</td>
<td>Publish a message to a subject, with optional reply subject</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#PUBACK" target="_blank" rel="noopener"><code>PubAck</code></a></td>
<td>Server</td>
<td>An acknowledgement that a published message has been processed on the server</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#MSGPROTO" target="_blank" rel="noopener"><code>MsgProto</code></a></td>
<td>Server</td>
<td>A message from the NATS Streaming Server to a subscribing client</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#ACK" target="_blank" rel="noopener"><code>Ack</code></a></td>
<td>Client</td>
<td>Acknowledges that a message has been received</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CLOSEREQ" target="_blank" rel="noopener"><code>CloseRequest</code></a></td>
<td>Client</td>
<td>Request sent to close the connection to the NATS Streaming Server</td>
</tr>
<tr>
<td><a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CLOSERESP" target="_blank" rel="noopener"><code>CloseResp</code></a></td>
<td>Server</td>
<td>Result of the close request</td>
</tr>
</tbody></table>
<p>The following sections explain each protocol message.</p>
<h3 id="ConnectRequest"><a href="#ConnectRequest" class="headerlink" title="ConnectRequest"></a>ConnectRequest</h3><p><strong>Description</strong></p>
<p>A  connection request is sent when a streaming client connects to the NATS  Streaming Server. The connection request contains a unique identifier  representing the client, and an inbox subject the client will listen on  for incoming heartbeats. The identifier <em>*must</em>- be unique; a  connection attempt with an identifier currently in use will fail. The  inbox subject is the subject where the client receives incoming  heartbeats, and responds by publishing an empty NATS message to the  reply subject, indicating it is alive. The NATS Streaming Server will  return a <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CONNRESP" target="_blank" rel="noopener">ConnectResponse</a> message to the reply subject specified in the NATS request message.</p>
<p>This request is published to a subject comprised of the <code>&lt;discover-prefix&gt;.cluster-id</code>, for example, if a NATS Streaming Server was started with a cluster-id of <code>mycluster</code>, and the default prefix was used, the client publishes to <code>_STAN.discover.mycluster</code></p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>clientID</code>: A unique identifier for a client</li>
<li><code>heartbeatInbox</code>: An inbox to which the NATS Streaming Server will send heartbeats for the client to process</li>
</ul>
<h3 id="ConnectResponse"><a href="#ConnectResponse" class="headerlink" title="ConnectResponse"></a>ConnectResponse</h3><p><strong>Description</strong></p>
<p>After a <code>ConnectRequest</code>  is published, the NATS Streaming Server responds with this message on  the reply subject of the underlying NATS request. The NATS Streaming  Server requires the client to make requests and publish messages on  certain subjects (described above), and when a connection is successful,  the client saves the information returned to be used in sending other  NATS streaming protocol messages. In the event the connection was not  successful, an error is returned in the <code>error</code> field.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>pubPrefix</code>: Prefix to use when publishing</li>
<li><code>subRequests</code>: Subject used for subscription requests</li>
<li><code>unsubRequests</code>: Subject used for unsubscribe requests</li>
<li><code>closeRequests</code>: Subject for closing a connection</li>
<li><code>error</code>: An error string, which will be empty/omitted upon success</li>
<li><code>publicKey</code>: Reserved for future use</li>
</ul>
<h3 id="SubscriptionRequest"><a href="#SubscriptionRequest" class="headerlink" title="SubscriptionRequest"></a>SubscriptionRequest</h3><p><strong>Description</strong></p>
<p>A <code>SubscriptionRequest</code> is published on the subject returned in the <code>subRequests</code> field of a <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CONNRESP" target="_blank" rel="noopener"><code>ConnectResponse</code></a>, and creates a subscription to a subject on the NATS Streaming Server. This will return a <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#SUBRESP" target="_blank" rel="noopener">SubscriptionResponse</a> message to the reply subject specified in the NATS protocol request message.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>clientID</code>: Client ID originally provided in the <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CONNREQ" target="_blank" rel="noopener">ConnectRequest</a></li>
<li><code>subject</code>: Formal subject to subscribe to, e.g. foo.bar</li>
<li><code>qGroup</code>: Optional queue group</li>
<li><code>inbox</code>: Inbox subject to deliver messages on</li>
<li><code>maxInFlight</code>: Maximum inflight messages without an acknowledgement allowed</li>
<li><code>ackWaitInSecs</code>: Timeout for receiving an acknowledgement from the client</li>
<li><code>durableName</code>: Optional durable name which survives client restarts</li>
<li><code>startPosition</code>: An enumerated type specifying the point in history to start replaying data</li>
<li><code>startSequence</code>: Optional start sequence number</li>
<li><code>startTimeDelta</code>: Optional start time</li>
</ul>
<p><strong>StartPosition enumeration</strong></p>
<ul>
<li><code>NewOnly</code>: Send only new messages</li>
<li><code>LastReceived</code>: Send only the last received message</li>
<li><code>TimeDeltaStart</code>: Send messages from duration specified in the <code>startTimeDelta</code> field.</li>
<li><code>SequenceStart</code>: Send messages starting from the sequence in the <code>startSequence</code> field.</li>
<li><code>First</code>: Send all available messages</li>
</ul>
<h3 id="SubscriptionResponse"><a href="#SubscriptionResponse" class="headerlink" title="SubscriptionResponse"></a>SubscriptionResponse</h3><p><strong>Description</strong></p>
<p>The <code>SubscriptionResponse</code> message is the response from the <code>SubscriptionRequest</code>. After a client has processed an incoming <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#MSGPROTO" target="_blank" rel="noopener">MsgProto</a> message, it must send an acknowledgement to the <code>ackInbox</code> subject provided here.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>ackInbox</code>: subject the client sends message acknowledgements to the NATS Streaming Server</li>
<li><code>error</code>: error string, empty/omitted if no error</li>
</ul>
<h3 id="UnsubscribeRequest"><a href="#UnsubscribeRequest" class="headerlink" title="UnsubscribeRequest"></a>UnsubscribeRequest</h3><p><strong>Description</strong></p>
<p>The <code>UnsubscribeRequest</code> unsubcribes the connection from the specified subject. The inbox specified is the <code>inbox</code> returned from the NATS Streaming Server in the <code>SubscriptionResponse</code>.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>clientID</code>: Client ID originally provided in the <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CONNREQ" target="_blank" rel="noopener">ConnectRequest</a></li>
<li><code>subject</code>: Subject for the subscription</li>
<li><code>inbox</code>: Inbox subject to identify subscription</li>
<li><code>durableName</code>: Optional durable name which survives client restarts</li>
</ul>
<h3 id="PubMsg"><a href="#PubMsg" class="headerlink" title="PubMsg"></a>PubMsg</h3><p><strong>Description</strong></p>
<p>The <code>PubMsg</code> protocol message is published from a client to the NATS Streaming Server. The GUID must be unique, and is returned in the <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#PUBACK" target="_blank" rel="noopener">PubAck</a> message to correlate the success or failure of storing this particular message.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>clientID</code>: Client ID originally provided in the <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CONNREQ" target="_blank" rel="noopener">ConnectRequest</a></li>
<li><code>guid</code>: a guid generated for this particular message</li>
<li><code>subject</code>: subject</li>
<li><code>reply</code>: optional reply subject</li>
<li><code>data</code>: payload</li>
<li><code>sha256</code>: optional sha256 of payload data</li>
</ul>
<h3 id="PubAck"><a href="#PubAck" class="headerlink" title="PubAck"></a>PubAck</h3><p><strong>Description</strong></p>
<p>The <code>PubAck</code>  message is an acknowledgement from the NATS Streaming Server that a  message has been processed. The message arrives on the subject specified  on the reply subject of the NATS message the <code>PubMsg</code> was published on. The GUID is the same GUID used in the <code>PubMsg</code>  being acknowledged. If an error string is present, the message was not  persisted by the NATS Streaming Server and no guarantees regarding  persistence are honored. <code>PubAck</code> messages may be handled asynchronously from their corresponding <code>PubMsg</code> in the client.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>guid</code>: GUID of the message being acknowledged by the NATS Streaming Server</li>
<li><code>error</code>: An error string, empty/omitted if no error</li>
</ul>
<h3 id="MsgProto"><a href="#MsgProto" class="headerlink" title="MsgProto"></a>MsgProto</h3><p><strong>Description</strong></p>
<p>The <code>MsgProto</code> message is received by client from the NATS Streaming Server, containing the payload of messages sent by a publisher. A <code>MsgProto</code> message that is not acknowledged with an <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#ACK" target="_blank" rel="noopener">Ack</a> message within the duration specified by the <code>ackWaitInSecs</code> field of the subscription request will be redelivered.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>sequence</code>: Globally ordered sequence number for the subject’s channel</li>
<li><code>subject</code>: Subject</li>
<li><code>reply</code>: Optional reply</li>
<li><code>data</code>: Payload</li>
<li><code>timestamp</code>: Time the message was stored in the server.</li>
<li><code>redelivered</code>: Flag specifying if the message is being redelivered</li>
<li><code>CRC32</code>: Optional IEEE CRC32</li>
</ul>
<h3 id="Ack"><a href="#Ack" class="headerlink" title="Ack"></a>Ack</h3><p><strong>Description</strong></p>
<p>An <code>Ack</code> message is an acknowledgement from the client that a <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#MSGPROTO" target="_blank" rel="noopener">MsgProto</a> message has been considered received. It is published to the <code>ackInbox</code> field of the <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#SUBRESP" target="_blank" rel="noopener"><code>SubscriptionResponse</code></a>.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>subject</code>: Subject of the message being acknowledged</li>
<li><code>sequence</code>: Sequence of the message being acknowledged</li>
</ul>
<h3 id="CloseRequest"><a href="#CloseRequest" class="headerlink" title="CloseRequest"></a>CloseRequest</h3><p><strong>Description</strong></p>
<p>A <code>CloseRequest</code> message is published on the <code>closeRequests</code> subject from the <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CONNRESP" target="_blank" rel="noopener"><code>ConnectResponse</code></a>,  and notifies the NATS Streaming Server that the client connection is  closing, allowing the server to free up resources. This message should <em>*always</em>- be sent when a client is finished using a connection.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>clientID</code>: Client ID originally provided in the <a href="https://www.nats.io/documentation/streaming/nats-streaming-protocol/#CONNREQ" target="_blank" rel="noopener">ConnectRequest</a></li>
</ul>
<h3 id="CloseResponse"><a href="#CloseResponse" class="headerlink" title="CloseResponse"></a>CloseResponse</h3><p><strong>Description</strong></p>
<p>The <code>CloseResponse</code> is sent by the NATS Streaming Server on the reply subject of the <code>CloseRequest</code> NATS message. This response contains any error that may have occurred with the corresponding close call.</p>
<p><strong>Message Structure</strong></p>
<ul>
<li><code>error</code>: error string, empty/omitted if no error</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:null">Wang YangYang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://wangyangyangisme.github.io/2019/09/27/nats-NATS-Streaming/">http://wangyangyangisme.github.io/2019/09/27/nats-NATS-Streaming/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://wangyangyangisme.github.io" target="_blank">WangYangYang</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=null" async="async"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/donat/76bc52296bcf2e0b7a1d628106ffcd52.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/donat/fab2285fdcd13ead0a8b4a853c659d03.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/09/27/nats-NATS%E5%92%8CNATS%20Streaming%E4%BD%BF%E7%94%A8/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/939916bec37ea8f169680b4d133f4a86.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">NATS和NATS Streaming</div></div></a></div><div class="next-post pull_right"><a href="/2019/09/27/nats-NATS-%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/nats/285494672816019cfb027039031cb3ca.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Nats管理服务器</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: true,
  verify: false,
  appId: '49gEIIGN7uRbL6vHhieSpBzM-MdYXbMMI',
  appKey: 'uqts0urLKwikYQ0fKmIkMHBE',
  placeholder: '请留下你的脚印',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Wang YangYang</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://wangyangyangisme.github.io/">blog</a>!</div><div class="icp"><a><img class="icp-icon" src="/img/icp.png"/><span></span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/click_heart.js"></script><script src="/js/search/algolia.js"></script></body></html>