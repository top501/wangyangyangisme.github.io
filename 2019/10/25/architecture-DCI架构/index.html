<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>DCI架构 | WangYangYang</title><meta name="description" content="DCI架构"><meta name="keywords" content="architecture"><meta name="author" content="Wang YangYang"><meta name="copyright" content="Wang YangYang"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/theme/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="DCI架构"><meta name="twitter:description" content="DCI架构"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/adde6bf5e9380e7166faad612f669036.jpg"><meta property="og:type" content="article"><meta property="og:title" content="DCI架构"><meta property="og:url" content="http://wangyangyangisme.github.io/2019/10/25/architecture-DCI%E6%9E%B6%E6%9E%84/"><meta property="og:site_name" content="WangYangYang"><meta property="og:description" content="DCI架构"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/adde6bf5e9380e7166faad612f669036.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      now = new Date();
      hour = now.getHours();
      isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://wangyangyangisme.github.io/2019/10/25/architecture-DCI%E6%9E%B6%E6%9E%84/"><link rel="prev" title="CQRS模式" href="http://wangyangyangisme.github.io/2019/10/25/architecture-CQRS%E6%A8%A1%E5%BC%8F/"><link rel="next" title="六边形架构" href="http://wangyangyangisme.github.io/2019/10/25/architecture-%E5%85%AD%E8%BE%B9%E5%BD%A2%E6%9E%B6%E6%9E%84/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"C4QN4OTLJM","apiKey":"c2c026ba64eeb77abd2164975fa41f34","indexName":"wyy","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://wangyangyangisme.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: false,
  isFontAwesomeV5: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/theme/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">191</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">20</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">38</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movie/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#The-DCI-Architecture-A-New-Vision-of-Object-Oriented-Programming"><span class="toc-text">The DCI Architecture: A New Vision of Object-Oriented Programming</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Objects-are-principally-about-people-and-their-mental-models—not-polymorphism-coupling-and-cohesion"><span class="toc-text">Objects are principally about people and their mental  models—not polymorphism, coupling and cohesion</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#We’ve-been-good-at-the-mind-meld-of-structure"><span class="toc-text">We’ve been good at the mind-meld of structure</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MVC-is-about-people-and-their-mental-models—not-the-Observer-pattern"><span class="toc-text">MVC is about people and their mental models—not the Observer  pattern</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Direct-Manipulation-Metaphor"><span class="toc-text">The Direct Manipulation Metaphor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#…-but-in-spite-of-capturing-structure-OO-fails-to-capture-behavior"><span class="toc-text">… but in spite of capturing structure, OO fails to capture  behavior</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Where-did-we-go-wrong"><span class="toc-text">Where did we go wrong?</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Back-into-the-Users’-Head"><span class="toc-text">Back into the Users’ Head</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Data-representing-the-user’s-mental-model-of-things-in-their-world"><span class="toc-text">Data: representing the user’s mental model of things  in their world</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Roles-a-not-so-new-concept-of-action-that-also-lives-in-users’-heads"><span class="toc-text">Roles: a (not so) new concept of action that also  lives in users’ heads</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Whole-objects-each-with-two-kinds-of-know-how"><span class="toc-text">Whole objects, each  with two kinds of know-how</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Roles-working-together-Contexts-and-Interactions"><span class="toc-text">Roles working together: Contexts and Interactions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nested-Contexts"><span class="toc-text">Nested  Contexts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Traits-as-the-design-trick-to-combine-characteristics-and-purpose"><span class="toc-text">Traits as the design trick to combine characteristics and  purpose</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Properties-of-DCI"><span class="toc-text">Properties of DCI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Other-bits"><span class="toc-text">Other bits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DCI-fulfilling-a-bit-of-history"><span class="toc-text">DCI fulfilling a bit of history</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/adde6bf5e9380e7166faad612f669036.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">WangYangYang</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movie/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">DCI架构</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-10-25<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-11-06</time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/architecture/">architecture</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">8.1k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 50 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2019/10/25/architecture-DCI%E6%9E%B6%E6%9E%84/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2019/10/25/architecture-DCI%E6%9E%B6%E6%9E%84/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><blockquote>
<p><a href="https://www.artima.com/articles/dci_vision.html" target="_blank" rel="noopener">https://www.artima.com/articles/dci_vision.html</a></p>
<p><a href="https://www.jdon.com/37976" target="_blank" rel="noopener">https://www.jdon.com/37976</a></p>
</blockquote>
<h1 id="The-DCI-Architecture-A-New-Vision-of-Object-Oriented-Programming"><a href="#The-DCI-Architecture-A-New-Vision-of-Object-Oriented-Programming" class="headerlink" title="The DCI Architecture: A New Vision of Object-Oriented Programming"></a>The DCI Architecture: A New Vision of Object-Oriented Programming</h1><p>by Trygve Reenskaug and James O. Coplien<br>March 20, 2009</p>
<blockquote>
<p>​    <strong>Summary</strong><br>​    Object-oriented programming was supposed to unify the    perspectives of the programmer and the end user in computer    code: a boon both to usability and program comprehension. While    objects capture structure well, they fail to capture system    action. DCI is a vision to capture the end user cognitive model    of roles and interactions between them.  </p>
</blockquote>
<h1 id="Objects-are-principally-about-people-and-their-mental-models—not-polymorphism-coupling-and-cohesion"><a href="#Objects-are-principally-about-people-and-their-mental-models—not-polymorphism-coupling-and-cohesion" class="headerlink" title="Objects are principally about people and their mental  models—not polymorphism, coupling and cohesion"></a>Objects are principally about people and their mental  models—not polymorphism, coupling and cohesion</h1><p>Object oriented programming grew out of <a href="http://www.dougengelbart.org/" target="_blank" rel="noopener">Doug Englebart</a>‘s vision of  the computer as an extension of the human mind. Alan Kay’s  <a href="http://www.mprove.de/diplom/gui/Kay72a.pdf" target="_blank" rel="noopener">Dynabook   vision</a>,<a href="https://www.artima.com/articles/dci_vision.html#r1" target="_blank" rel="noopener">1</a>  often regarded as the progenitor of modern personal lap-tops, was  perhaps the epitome of this vision: a truly personal computer  that was almost a companion, an extension of self. He would later  create a language, Smalltalk, to carry that vision into the very  source code. In fact, the goal of object-oriented programming  pioneers was to capture end user mental models in the code. Today  we are left with the legacy of these visions in the blossoming of  interactive graphical interfaces and the domination of  object-oriented languages in programming world-wide.</p>
<p>When a user approaches a GUI, he or she does two things:  <em>thinking</em> and <em>doing</em>. For a smooth interaction  between man and machine, the computer’s “mental” model (also the  programmer’s mental model) and the end user’s mental model must  align with each other in kind of mind-meld. In the end, any work  that users do on their side of the interface manipulates the  objects in the code. If the program provides accurate real-time  feedback about how user manipulations affect program state, it  reduces user errors and surprises. A good GUI provides this  service. Using an interactive program is like being a doctor  trying to navigate a probe through a patient’s bronchial tubes:  just as you can’t see the objects in program memory, you can’t  see the actual probe in the patient’s body. You need some  external representation of the program structure, or of the  bronchial probe, to guide your interaction with a program.</p>
<h2 id="We’ve-been-good-at-the-mind-meld-of-structure"><a href="#We’ve-been-good-at-the-mind-meld-of-structure" class="headerlink" title="We’ve been good at the mind-meld of structure"></a>We’ve been good at the mind-meld of structure</h2><p>Both object-oriented design and the Model-View-Controller  (MVC) framework grew to support this vision. MVC’s goal was to  provide the illusion of a direct connection from the end user  brain to the computer “brain”—its memory and processor.</p>
<p>In some interfaces, this correspondence is obvious: if you  create a circle on a PowerPoint® slide, the circle in your mind  directly maps onto its representation in computer memory. The  rows and columns of a spread sheet ledger map onto the screen  rows and columns in a spreadsheet program, which in turn map onto  the data structures in the program. Words on a text editor page  reflect both our model of a written document and the computer’s  model of stored text. The object approach to structuring makes  such alignment possible, and human thinking quickly aligns with  the computer’s notion of structure.</p>
<h3 id="MVC-is-about-people-and-their-mental-models—not-the-Observer-pattern"><a href="#MVC-is-about-people-and-their-mental-models—not-the-Observer-pattern" class="headerlink" title="MVC is about people and their mental models—not the Observer  pattern"></a>MVC is about people and their mental models—not the Observer  pattern</h3><p>Most programmers think of MVC as a fancy composition of  several instances of the Observer pattern. Most programming  environments provide MVC base classes that can be extended to  synchronize the state of the Model, the View, and the Controller.  (Model, View and Controller are actually roles that can be played  by the objects that the user provides—we’ll talk more about roles  later.) So it’s just a housekeeping technique, right? To think of  it that way is to take a nerd’s perspective. We’ll call that  perspective “Model-View-Controller.” More deeply, the framework  exists to separate the representation of information from user  interaction. In that capacity we’ll call it  “Model-View-Controller-<em>User</em>,” capturing all four of the  important actors at work—MVC-U for short.</p>
<p>It can serve us well to define additional terms more  precisely. MVC-U is all about making connections between computer  <em>data</em> and stuff in the end user’s head. <em>Data</em> are  the representation of information; in computers, we often  represent them as bits. But the bits themselves <em>mean</em>  nothing by themselves: they <em>mean</em> something only in the  mind of the user when there is an interaction between them. The  mind of the end user can interpret these data; then they become  <em>information</em>. <em>Information</em> is the term we use for  interpreted data. Information is a key element of the <em>end  user mental model</em>.<a href="https://www.artima.com/articles/dci_vision.html#r2" target="_blank" rel="noopener">2</a></p>
<p>This mapping first takes place as an end user approaches an  interactive interface, using it to create the path between the  data from which the interface is drawn, and his or her model of  the business world. A well-designed program does a good job of  capturing the information model in the data model, or at least of  providing the illusion of doing so. If the software can do that  then the user feels that the computer memory is an extension of  his or her memory. If not, then a “translation” process must  compensate for the mismatch. It’s at best awkward to do this  translation in the code (and it shouldn’t be necessary if the  coder knows the end user cognitive models). It is painful,  awkward, confusing, and error-prone for the end user to perform  this mapping in their head in real time. To unify these two  models is called the <em>direct manipulation metaphor</em>: the  sense that end users are actually manipulating objects in memory  that reflect the images in their head.</p>
<p>​    <img src="/" alt="Figure 1. Direct Manipulation " class="lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/architecture/architecture22.jpg">  </p>
<p>​     </p>
<h3 id="The-Direct-Manipulation-Metaphor"><a href="#The-Direct-Manipulation-Metaphor" class="headerlink" title="The Direct Manipulation Metaphor"></a>The Direct Manipulation Metaphor</h3><p>We want the system to provide a short path from the  information to the data that represents it in the program (Figure  1). The job of the <em>model</em> is to “filter” the raw data so  the programmer can think about them in terms of simple cognitive  models.     For example, a telephone system may have underlying objects that  represent the basic building blocks of local telephony called  <em>half-calls</em>. (Think about it: if you just had “calls,”  then where would the “call” object live if you were making a call  between two call centers in two different cities? The concept of  a “half-call” solves this problem.) However, a telephone operator  thinks of a “call” as a thing, which has a duration and may grow  or shrink in the number of parties connected to it over its  lifetime. The Model supports this illusion. Through the computer  interface the end user feels as though they are directly  manipulating a real thing in the system called a “Call.” Other  Models may present the same data (of a half-call) in another way,  to serve a completely different end user perspective. This  illusion of direct manipulation lies at the heart of the object  perspective of what computers are and how they serve people.</p>
<p>The View displays the Model on the screen. View provides a  simple protocol to pass information to and from the Model. The  heart of a View object presents the Model data in one particular  way that is of interest to the end user. Different views may  support the same data, <em>i.e.</em>, the same Models, in  completely different ways. The classic example is that one View  may show data as a bar graph while another shows the same data as  a pie chart.</p>
<p>The Controller creates Views and coordinates Views and Models.  It usually takes on the role of interpreting input user gestures,  which it receives as keystrokes, locater device data, and other  events.</p>
<p>​    <img src="/" alt="Figure 2. Model-View-Controller-User  " class="lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/architecture/architecture23.jpg">  </p>
<p>Together, these three <em>roles</em> define interactions  between the objects that play them—all with the goal of  sustaining the illusion that the computer memory is an extension  of the end user memory: that computer data reflect that end user  cognitive model (Figure 2). That summarizes  Model-View-Controller-User: it does a good job of supporting the  <em>thinking</em> part of computer/human interaction.</p>
<h2 id="…-but-in-spite-of-capturing-structure-OO-fails-to-capture-behavior"><a href="#…-but-in-spite-of-capturing-structure-OO-fails-to-capture-behavior" class="headerlink" title="… but in spite of capturing structure, OO fails to capture  behavior"></a>… but in spite of capturing structure, OO fails to capture  behavior</h2><p>Unfortunately, object orientation hasn’t fared so well to  capture how we reason about <em>doing</em>. There is no obvious  “place” for interactions to live, either on the GUI or in the  code. There are exceptions to this rule, particularly for simple  actions that involve only a single object. For example, a good  interface might allow us to use a well-placed paint brush to  change the color of a circle on the screen. In the program, the  code for re-coloring the circle is itself part of the circle. In  these simple cases the end user mental model, the code, and the  screen all align. But for a spreadsheet we can’t see the sum over  a column. Instead, we need to invoke some set of mystical  incantations to bring up a sub-window or other field that  recovers an earlier constructed formula. With appropriate screen  design and interaction design we can limit the damage for the end  user, and some user interfaces are surprisingly good at making  these actions visible. Still, it is far too often that such  interfaces are shrouded in mystery. Consider the totally opaque  ceremony that takes place in a popular word processor between a  picture and a paragraph as you strive to insert one into the  other.</p>
<p>As if things aren’t bad enough for the end user, they are as  bad or even worse for the programmer. Programmers are people,  too, and we want them to be able to map from their understanding  of user needs to their understanding of the code. Object-oriented  programming languages traditionally afford no way to capture  collaborations between objects. They don’t capture algorithms  that flow over those collaborations. Like the domain structure  captured by object instances, these collaborations and  interactions also have structure. They form part of the end user  mental model, but you can’t find a cohesive representation of  them in the code. For example, users have expectations for their  interactions with a spell-checker in a word processor and have a  preconceived notion of its interactions with the text, with some  dictionary, and with the end user. Which object should  encapsulate the spell-checking operation in a word processor: The  editing buffer? The dictionary? Some global spell-checker object?  Some of these options lead to poor cohesion of the object that  hosts spell checking while other options increase the coupling  between objects.</p>
<p>In this article, we’ll show how to combine roles, algorithms,  objects, and associations between them to provide a stronger  mapping between the code and the end-user mental model. The  result is an architecture based on the object <em>D</em>ata, the  <em>C</em>ollaborations between objects, and the way that Use  Cases scenarios comprise <em>I</em>nteractions between roles: the  <a href="http://folk.uio.no/trygver/2008/commonsense.pdf" target="_blank" rel="noopener">DCI   architecture</a>.</p>
<h2 id="Where-did-we-go-wrong"><a href="#Where-did-we-go-wrong" class="headerlink" title="Where did we go wrong?"></a>Where did we go wrong?</h2><p>We can trace much of our failure to capture the end user  mental model of <em>doing</em> to a kind of object mythology that  flourished doing the 1980s and into the first half of the 1990s.  Some buzzwords of this mindset included <em>anthropomorphic  design</em>, <em>smart objects</em>, and <em>emergent system  behavior</em>. We were taught that system behavior should  “emerge” from the interaction of dozens, hundreds or thousands of  local methods. The word of the day was: think locally, and global  behavior would take care of itself. Anyone caught writing a  method that looked like a procedure, or caught doing procedural  decomposition, was shunned by the OO community as “not getting  it.”</p>
<p>In fact, most GUI problems start with the programmer’s  inability to capture the end user cognitive model in the code.  The MVC framework makes it possible for the user to reason about  what the system <em>is</em>: the <em>thinking</em> part of the  user cognitive model. But there is little in object orientation,  and really nothing in MVC, that helps the developer capture  <em>doing</em> in the code. The developer doesn’t have a place  where he or she can look to reason about end user behavioral  requirements.</p>
<p>Back in the 1960s, we could take the behavioral requirements  for a program, and the FORTRAN code that implemented them, and  give both of them to an office mate—together with a big red  pen—to review whether the code matched the requirements. The  overall form of the code reflected the form of the requirements.  In 1967, software engineering took away my ability to do this:  the algorithm had to be distributed across the objects, because  to have a large method that represented an entire algorithm was  believed to not be a “pure” object-oriented design. How did we  decide to split up the algorithm and distribute its parts to  objects? On the basis of coupling and cohesion. Algorithms  (methods) had to be collocated with the object that showed the  most affinity for the algorithm: optimizing cohesion.</p>
<p>That works fine when an algorithm lives within a single  object, as might be true for changing the color of a circle on  the screen, or adding a typed character to a word processor’s  text buffer. However, interesting business functionality often  cuts across objects. The spell-checker in the text editor  involves the screen, some menus, the text buffer, and a  dictionary. Even for a shapes editor, the problem of calculating  overlapping regions belongs to multiple objects.  Object-orientation pushed us into a world where we had to split  up the algorithm and distribute it across several objects, doing  the best piecemeal job that we could.</p>
<h1 id="Back-into-the-Users’-Head"><a href="#Back-into-the-Users’-Head" class="headerlink" title="Back into the Users’ Head"></a>Back into the Users’ Head</h1><p>If the goal of object-orientation was to capture end users’  conceptual model of their worlds, it might serve us well to  journey back into that space to find out what lurks there. We’ll  start with familiar territory: the data model, which most nerds  today call <em>objects</em> (but then, to our puzzlement, model  and discuss only as <em>classes</em>) and then move on to more  dynamic concepts called <em>roles</em> and  <em>collaborations</em>. All three of these—the data model, the  role model, and the collaboration model—are conceptual concerns  independent of programming language. But, of course, one of our  goals is that the programming language <em>should</em> be able to  express these things. So we’ll also look at programming concepts  that express these concepts in code. One of these concepts is  called a <em>class</em> (and we’re again on familiar ground), and  the second is called a <em>role</em>.</p>
<h2 id="Data-representing-the-user’s-mental-model-of-things-in-their-world"><a href="#Data-representing-the-user’s-mental-model-of-things-in-their-world" class="headerlink" title="Data: representing the user’s mental model of things  in their world"></a>Data: representing the user’s mental model of <em>things</em>  in their world</h2><p>Managing data is arguably the second oldest profession in  computer science (we’ll talk about the <a href="https://www.artima.com/articles/dci_vision.html#oldest" target="_blank" rel="noopener">oldest   profession</a> below). The old Data Flow Diagram (DFD) people  used to tell us that the data are the stable part of design. This  truism carried forward into objects, and object designers were  encouraged to look for stable object structures.</p>
<p>A particularly simplistic rule of thumb in early  object-oriented design was: nouns (e.g. in the requirements  document) are objects, and verbs are methods. This dichotomy  naturally fit the two concepts that programming languages could  express. Object-oriented programming languages—particularly the  “pure” ones—expressed <em>everything</em> in terms of objects or  methods on objects. (Of course, most programming languages used  classes to do this. The point is that nothing was supposed to  exist outside of an object framework.) So if I looked at a  Savings Account object, the fact that it was an object led us to  capture it as such (or as a class). The fact that it could both  decrease its balance and could do a withdrawal were lumped  together as methods. Both are behaviors. However, these two  behaviors are radically different. Decreasing the balance is  merely a characteristic of the data: what it <em>is</em>. To do a  withdrawal reflects the <em>purpose</em> of the data: what it  <em>does</em>. Being able to handle a withdrawal—which infers  transaction semantics, user interactions, recovery, handling  error conditions and business rules—far outstrips any notion of a  data model. <em>Withdrawal</em>, in fact, is a behavior of the  system and entails system state, whereas reducing the balance is  what makes an account an account and relates only to the object  state. These two properties are extremely different in kind from  the important perspectives of system architecture, software  engineering, and maintenance rate of change. Object-orientation  lumped them into the same bucket.</p>
<p>The problem with this approach is this: If objects are  supposed to remain stable, and if all of the code is in objects,  then where do I represent the parts that change? A key,  longstanding hallmark of a good program is that it separates what  is stable from what changes in the interest of good maintenance.  If objects reflect the stable part of the code, there must be a  mechanism other than objects to express requirements changes in  the code, supporting the Agile vision of evolution and  maintainability. But objects are stable—and in an object-oriented  program, there is no “other mechanism.”</p>
<p>Stuck with these artificial constraints, the object world came  up with an artificial solution: using inheritance to express  “programming by difference” or “programming by extension.”  Inheritance is perhaps best understood as a way to classify  objects in a domain model. For example, an exclusive-access file  may be a special kind of disk file, or magnetic, optical and  mechanical sensors might be different implementations of the more  general notion of sensor. (You might object and say that this is  subtyping rather than inheritance, but few programming languages  distinguish the expression of these two intents). Because  inheritance could express variations on a base, it quickly became  a mechanism to capture behavioral additions to a “stable” base  class. In fact, this approach became heralded as an honorable  design technique called the <em>open-closed principle</em>: that  a class was closed to modification (i.e., it had to remain stable  to capture the stability of the domain model) but open to  extension (the addition of new, unanticipated code that supported  new user behaviors). This use of inheritance crept out of the  world of programming language into the vernacular of design.</p>
<p>Somewhere along the line, statically typed languages got the  upper hand, supported by software engineering. One important  aspect of static type system analysis was the class: a construct  that allowed the compiler to generate efficient code for method  lookup and polymorphism. Even Smalltalk, whose initial vision of  objects and a dynamic run-time environment was truly visionary,  fell victim to the class compromise. The class became the  implementation tool for the analysis concept called an object.  This switch from dynamics to statics was the beginning of the end  for capturing dynamic behavior.</p>
<p>Inheritance also became an increasingly common way to express  subtyping, especially in Smalltalk and C++. You could cheat in  Smalltalk and invoke a method in any class in an object’s  inheritance hierarchy whether or not a default implementation  appeared in the base class. It would work, but it exacerbated the  discovery problem, because the base class interface wasn’t  representative of the object’s total behavior. The statically  typed languages created a culture of inheritance graphs as design  abstractions in their own right, fully represented by the base  class interface. But because programming by extension took place  at the bottom of the hierarchy, newly added methods either didn’t  appear in the base class—or, worse, needed to be added there  (e.g., as pure virtual functions in C++) every time the  inheritance hierarchy was extended to incorporate a new  method.</p>
<p>The alternative was to take advantage of static typing, and to  let clients of a derived class have access to the class  declaration of classes that were added for  programming-by-extension. That preserved the “integrity” of the  base class. However, it also meant that statically typed  languages encouraged cross-links between the buried layers of  class hierarchies: an insidious form of violating encapsulation.  One result was global header file proliferation. The C++ world  tried to respond with RTTI and a variety of other techniques to  help manage this problem while the community of dynamically typed  languages shrugged and noted that this wasn’t a problem for  them.</p>
<p>The rhetoric of the object community started turning against  inheritance in the mid-1980s, but only out of a gut feel that was  fueled by a few horror stories (inheritance hierarchies 25 deep)  and the resulting software engineering nightmare of trying to  trace business behavior back into the code.</p>
<p>In the end, this whole sordid story suggests that extension by  derivation was a less-than-ideal solution. But, in fact,  inheritance wasn’t the most infested fly in the ointment. Most  such code changes could be traced back to behavioral requirements  changes, and most such changes were driven by end users’ desire  for new behaviors in the code. Software is, after all, a service  and not really a product, and its power lies in its ability to  capture tasks and the growth and changes in tasks. This is  particularly credible in light of the argument (well-sustained  over the years) that the data model is relatively stable over  time. The discord between the algorithm structure and domain  structure would be the ultimate undoing of classes as units of  growth; we’ll get back to that <a href="https://www.artima.com/articles/dci_vision.html#below" target="_blank" rel="noopener">below</a>.</p>
<p>There is another key learning that we’ll carry forward from  this perspective: that domain classes should be dumb. Basic  domain objects represent our primordial notions of the essence of  a domain entity, rather than the whole universe of processes and  algorithms that burdens traditional object-oriented development  as Use Cases pile up over time. If I asked you what a Savings  Account object can do, you’d be wise to say that it can increase  and decrease its balance, and report its balance. But if you said  that it can handle a deposit, we’re suddenly in the world of  transactions and interactions with an ATM screen or an audit  trail. Now, we’ve jumped outside the object and we’re talking  about coupling with a host of business logic that a simple  Savings Account has no business knowing about. Even if we decided  that we wanted to give objects business intelligence from the  beginning, confident that we could somehow get it right so the  interface wouldn’t have to change much over time, such hopes are  dashed by the fact that initial Use Cases give you a very small  slice of the life-time code of a system. We must separate simple,  stable data models from dynamic behavioral models.</p>
<h2 id="Roles-a-not-so-new-concept-of-action-that-also-lives-in-users’-heads"><a href="#Roles-a-not-so-new-concept-of-action-that-also-lives-in-users’-heads" class="headerlink" title="Roles: a (not so) new concept of action that also  lives in users’ heads"></a>Roles: a (not so) new concept of <em>action</em> that also  lives in users’ heads</h2><p>So let’s go back into the user’s head and revisit the usual  stereotype that everything up there is an object. Let’s say that  we’re going to build an ATM and that one Use Case we want to  support is Money Transfer. If we were to ask about your fond  remembrances of your last account funds transfer, what would you  report? A typical response to such a question takes the form,  “Well, I chose a source account and a transfer amount, and then I  chose a destination account, and I asked the system to transfer  that amount between the accounts.” In general, people are often a  little less precise than this, using words like “one account” and  “another account” instead of “source account” and “destination  account.”</p>
<p>Notice that few people will say “I first picked my savings  account, and then an amount, and then picked my investment  account…” and so forth. Some respondents may actually say that,  but to go to that level artificially constrains the problem. If  we look at such scenarios for any pair of classes, they will be  the same, modulo the class of the two accounts. The fact is that  we all carry, in our heads, a general model of what fund transfer  means, independent of the types of the account involved. It is  that model—that <em>interaction</em>—that we want to mirror from  the user’s mind into the code.</p>
<p>So the first new concept we introduce is <em>roles</em>.  Whereas objects capture what objects <em>are</em>, roles capture  collections of behaviors that are about what objects <em>do</em>.  Actually, it isn’t so much that the concept of roles is new as it  is unfamiliar. Role-based modeling goes back at least to the  OORAM method, which was published as a book in 1996.<a href="https://www.artima.com/articles/dci_vision.html#r3" target="_blank" rel="noopener">3</a>  Roles are so unfamiliar to us because so much of our object  thinking (at least as nerds) comes from our programming  languages, and languages have been impoverished in their ability  to express roles.</p>
<p>The interactions that weave  their way through the roles are also not new to programming: we  call them algorithms, and they are probably the only design  formalism that predates data as having their own vocabulary and  rules of thumb. What’s interesting is that we consciously weave  the algorithms through the roles. It is as if we had broken down  the algorithm using good old procedural decomposition and broken  the lines of decomposition along role boundaries. We do the same  thing in old-fashioned object modeling, except that we break the  lines of procedural decomposition (methods) along the lines of  object boundaries.</p>
<p>Unfortunately, object  boundaries already mean something else: they are loci of  encapsulated domain knowledge, of the data. There is little that  suggests that the stepwise refinement of an algorithm into  cognitive chunks should match the demarcations set by the data  model.     Old-fashioned object orientation forced us to use the same  mechanism for both demarcations, and this mechanism was called a  <em>class</em>. One or the other of the demarcating mechanisms is  likely to win out. If the algorithmic decomposition wins out, we  end up with algorithmic fragments landing in one object but  needing to talk to another, and coupling metrics suffer. If the  data decomposition wins out, we end up slicing out just those  parts of the algorithm that are pertinent to the topic of the  object to which they are assigned, and we end up with very small  incohesive methods. Old-fashioned object orientation explicitly  encouraged the creation of such fine-grain methods, for example,  a typical Smalltalk method is three statements long.</p>
<p>Roles provide natural boundaries to carry collections of  operations that the user logically associates with each other. If  we talk about the Money Transfer example and its roles of Source  Account and Destination Account, the algorithm might look like  this:</p>
<ol>
<li>Account holder chooses to transfer money from one account    to another</li>
<li>System displays valid accounts</li>
<li>User selects Source Account</li>
<li>System displays remaining valid accounts</li>
<li>Account holder selects Destination Account</li>
<li>System requests amount</li>
<li>Account holder inputs amount</li>
<li>Move Transferred Money and Do Accounting</li>
</ol>
<p>The Use Case Move Transferred Money and Do Accounting might  look like this:</p>
<ol>
<li>System verifies funds are available</li>
<li>System updates the accounts</li>
<li>System updates statement information</li>
</ol>
<p>The designer’s job is to transform this Use Case into an  algorithm that honors design issues such as transactions. The  algorithm might look like this:</p>
<ol>
<li>Source account begins transaction</li>
<li>Source account verifies funds available (notice that this    must be done inside the transaction to avoid an intervening    withdrawal!)</li>
<li>Source account reduces its own balance</li>
<li>Source account requests that Destination Account increase    its balance</li>
<li>Source Account updates its log to note that this was a    transfer (and not, for example, simply a withdrawal)</li>
<li>Source account requests that Destination Account update its    log</li>
<li>Source account ends transaction</li>
<li>Source account informs Account Holder that the transfer has    succeeded</li>
</ol>
<p>The code for this algorithm might look like this:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ConcreteAccountType</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">TransferMoneySourceAccount</span>:</span> <span class="keyword">public</span> MoneySource</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function">ConcreteDerived *<span class="keyword">const</span> <span class="title">self</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;ConcreteDerived*&gt;(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">transferTo</span><span class="params">(Currency amount)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// This code is reviewable and</span></span><br><span class="line">        <span class="comment">// meaningfully testable with stubs!</span></span><br><span class="line">        beginTransaction();</span><br><span class="line">        <span class="keyword">if</span> (self()-&gt;availableBalance() &lt; amount) &#123;</span><br><span class="line">            endTransaction();</span><br><span class="line">            <span class="keyword">throw</span> InsufficientFunds();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            self()-&gt;decreaseBalance(amount);</span><br><span class="line">            recipient()-&gt;increaseBalance (amount);</span><br><span class="line">            self()-&gt;updateLog(<span class="string">"Transfer Out"</span>, DateTime(),</span><br><span class="line">                              amount);</span><br><span class="line">            recipient()-&gt;updateLog(<span class="string">"Transfer In"</span>,</span><br><span class="line">                                   DateTime(), amount);</span><br><span class="line">        &#125;</span><br><span class="line">        gui-&gt;displayScreen(SUCCESS_DEPOSIT_SCREEN);</span><br><span class="line">        endTransaction();</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>It is almost a literal expansion from the Use Case. That makes  it more understandable than if the logic is spread over many  class boundaries that are arbitrary with respect to the natural  organization of the logic—as found in the end user mental model.  We call this a <em>methodful role</em>—a concept we explore more  thoroughly in the next section.   </p>
<h1 id="Whole-objects-each-with-two-kinds-of-know-how"><a href="#Whole-objects-each-with-two-kinds-of-know-how" class="headerlink" title="Whole objects, each  with two kinds of know-how"></a>Whole objects, each  with two kinds of know-how</h1><p>At their heart, roles embody generic, abstract algorithms.  They have no flesh and blood and can’t really <em>do</em>  anything. At some point it all comes down to objects—the same  objects that embody the domain model.</p>
<p>The <em>fundamental problem</em> solved by DCI is that people  have two different models in their heads of a single, unified  thing called an object. They have the what-the-system-<em>is</em>  data model that supports <em>thinking</em> about a bank with its  accounts, and the what-the-system-<em>does</em> algorithm model  for transferring funds between accounts. Users recognize  individual objects and their domain existence, but each object  must also implement behaviors that come from the user’s model of  the interactions that tie it together with other objects through  the roles it plays in a given Use Case. End users have a good  intuition about how these two views fit together. For example,  end users know that their Savings Accounts take on certain  responsibilities in the role of a Source Account in a Money  Transfer Use Case. <em>That</em>, too—the mapping between the  role view and data view—is also part of the user cognitive model.  We call it the <em>Context</em> of the execution of a Use Case  scenario.</p>
<p>We depict the model in Figure 3. On the right we capture the  end user role abstractions as interfaces (as in Java or in C#; in  C++, we can use pure abstract base classes). These capture the  basic architectural form, to be filled in as requirements and  domain understanding grow. At the top we find roles that start as  clones of the role abstractions on the right, but whose methods  are filled in. For a concept like a Source Account in a Money  Transfer Use Case, we can define some methods independent of the  exact type of object that will play that role at run time. These  roles are <em>generic types</em>, analogous to Java or Ada  generics or C++ templates. These two artifacts together capture  the end user model of roles and algorithms in the code.</p>
<p>​    <img src="/" alt="Figure 3. Combining Structure and Algorithm in a Class" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/architecture/architecture24.jpg">  </p>
<p>On the left we have our old friends, the classes. Both the  roles <em>and</em> classes live in the end user’s head. The two  are fused at run time into a single object. Since objects come  from classes in most programming languages, we have to make it  appear as though the domain classes can support the business  functions that exist in the separate source of the role  formalisms. At compile time programmers must face the end user’s  models both of Use Case scenarios and the entities they operate  on. We want to help the programmer capture those models  <em>separately</em> in two different programming constructs,  honoring the dichotomy in the end user’s head. We usually think  of classes as the natural place to collect such behaviors or  algorithms together. But we must also support the seeming paradox  that each of these <em>compile</em>-time concepts co-exists with  the other at <em>run</em> time in a single thing called the  object.</p>
<p>This sounds hard, but even end users are able to combine parts  of these two views in their heads. That’s why they know that a  Savings Account—which is just a way of talking about how much  money I can access right now through a certain key called an  account number—can be asked to play the role of a Source Account  in a Money Transfer operation. So we should be able to snip  operations from the Money Transfer Use Case scenario and add them  to the rather dumb Savings Account object. Figure 3 shows such  gluing together of the role logic (the arcs) and the class logic  (rounded rectangles). Savings Account already has operations that  allow it to carry out its humble job of reporting, increasing, or  decreasing its balance. These latter operations, it supports (at  run time) from its domain class (a compile-time construct). The  more dynamic operations related to the Use Case scenario come  from the roles that the object plays. The collections of  operations snipped from the Use Case scenario are called  <em>roles</em>. We want to capture them in closed form (source  code) at compile time, but ensure that the object can support  them when the corresponding Use Case comes around at run time.  So, as we show in Figure 4, an object of a class supports not  only the member functions of its class, but also can execute the  member functions <em>of the role it is playing at any given  time</em> as though they were its own. That is, we want to  <em>inject</em> the roles’ logic into the objects so that they  are as much part of the object as the methods that the object  receives from its class at instantiation time.</p>
<p>​    <img src="/" alt="Figure 4. Combining Structure and Algorithm in an Object" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/architecture/architecture25.jpg">  </p>
<p>Here, we set things up so each object has all possible logic  at compile time to support whatever role it might be asked to  play. However, if we are smart enough to inject just enough logic  into each object at run time, just as it is needed to support its  appearance in a given role, we can do that, too.</p>
<h2 id="Roles-working-together-Contexts-and-Interactions"><a href="#Roles-working-together-Contexts-and-Interactions" class="headerlink" title="Roles working together: Contexts and Interactions"></a>Roles working together: Contexts and Interactions</h2><p>When I go up to an ATM to do a money transfer, I have two  objects in mind (let’s say that they are My Savings Account and  My Investment Account), as well as a vision of the process, or  algorithm, that takes money from some Source Account and adds it  to some Destination Account in a way that is agreeable to both me  and the bank. (It’s probably true that My Savings Account isn’t  actually an object in a real bank, but it probably <em>is</em> an  object within the realm of the ATM. Even if it isn’t, there are  some <a href="https://www.artima.com/articles/dci_vision.html#NestedContexts" target="_blank" rel="noopener">nice generalizations in DCI</a>  that cause it not to matter.) I also have a notion of how to map  between these two. I establish that mapping, or context, as I  interact with the ATM.</p>
<p>First, I probably establish that I want to do a funds  transfer. That puts a money-transfer scenario in my mind’s  “cache,” as well as bringing some kind of representation of the  roles and algorithms into the computer memory. We can capture  these scenarios in terms of roles, as described above.</p>
<p>Second, I probably choose the Source Account and Destination  account for the transfer. In the computer, the program brings  those objects into memory. They are dumb, dumb data objects that  know their balance and a few simple things like how to increase  or decrease their balance. Neither account object alone  understands anything as complex as a database transaction: that  is a higher-order business function related to  what-the-system-does, and the objects individually are about  what-the-system-is. The higher-level knowledge doesn’t live in  the objects themselves but in the roles that those objects play  in this interaction.</p>
<p>Now I want to do the transfer. For the transfer to happen, I  need My Savings Account to be able to play the role of Source  Account, and the My Investment Account object to play the role of  the Destination Account. Imagine that we could magically glue the  member functions of the roles onto their respective objects, and  then just run the interaction. Each role “method” would execute  in the context of the object into which it had been glued, which  is exactly how the end user perceives it. In the <a href="https://www.artima.com/articles/dci_vision.html#WholeObjects" target="_blank" rel="noopener">next section</a> of this article we’ll look  exactly at how we give the objects the intelligence necessary to  play the roles they must play: for the time being, imagine that  we might use something like delegation or mix-ins or Aspects. (In  fact each of these approaches has at least minor problems and  we’ll use something else instead, but the solution is nonetheless  reminiscent of all of these existing techniques.)</p>
<p>​    <img src="/" alt="Figure 5. Mapping Roles to Objects" class="lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/blog/architecture/architecture26.jpg">  </p>
<p>The arrow from the Controller and Model into the Context just  shows that the Controller initiates the mapping, perhaps with  some parameters that give hints about the mapping, and that the  Model objects are the source of most mapping targets. The  Methodless Roles are identifiers through which application code  (in the Controller and in Methodful Roles) accesses objects that  provide services available through identifiers of that type. This  becomes particularly useful in languages with compile-time type  checking, as the compiler can provide a modicum of safety that  ensures, at compile time, that a given object can and will  support the requested role functionality.</p>
<p>By this time, all the objects necessary to affect the transfer  are in memory. As indicated above, the end user also has a  process or algorithm in mind to do the money transfer in terms of  the roles involved. We need to pick out code that can run that  algorithm, and then all we have to do is line up the right  objects with the right roles and let the code run. As shown in  Figure 5, the algorithm and role-to-object mapping are owned by a  <em>Context</em> object. The Context “knows” how to find or  retrieve the objects that become the actual actors in this Use  Case, and “casts” them to the appropriate roles in the Use Case  scenarios (we use the term “cast” at least in the theatrical  sense and conjecturally in the sense of some programming language  type systems). In a typical implementation there is a Context  object for each Use Case, and each Context includes an identifier  for each of the roles involved in that Use Case. All that the  Context has to do is bind the role identifiers to the right  objects. Then we just kick off the trigger method on the “entry”  role for that Context, and the code just runs. It might run for  nanoseconds or years—but it reflects the end user model of  computation.</p>
<p>Now we have the complete DCI architecture:</p>
<ul>
<li>The <em>data</em>, that live in the domain objects that are    rooted in domain classes;</li>
<li>The <em>context</em> that brings live objects into their    positions in a scenario, on demand;</li>
<li>The <em>interactions</em>, that describe end-user    algorithms in terms of the roles, both of which can be found in    end users’ heads.</li>
</ul>
<p>As shown in Figure 5, we can think of the Context as a table  that maps a role member function (a row of the table) onto an  object method (the table columns are objects). The table is  filled in based on programmer-supplied business intelligence in  the Context object that knows, for a given Use Case, what objects  should play what roles. A method of one role interacts with other  role methods in terms of their role interfaces, and is also  subject to the role-to-object mapping provided by the Context.  The code in the Controller can now deal with business logic  largely in terms of Contexts: any detailed object knowledge can  be written in terms of roles that are translated to objects  through the Context.</p>
<p>One way of thinking about this style of programming is that it  is a higher order form of polymorphism than supported by  programming languages. In fact, all of the polymorphism can be  under programmer control: roles are <em>explicitly</em> mapped to  objects, and every role method invocation can be statically  bound. This makes the code straightforward to analyze and  understand statically. Compare that with the usual implementation  of method dispatch in an object-oriented programming language,  where it is in general impossible to determine where a method  invocation will end up through a static analysis of the code.</p>
<p>In some implementations the Context also does the injection of  the business logic methods into the domain objects. This is  particularly true in implementations based on dynamic languages  such as Python and Ruby. In C++ and C# we usually “pre-load” all  of the business logic methods by injecting them at the class  level, which can be done even at compile time. In <a href="http://www.artima.com/shop/programming_in_scala" target="_blank" rel="noopener">Scala</a> we  can achieve a hybrid when creating an object from a domain class  by injecting the role methods as part of the instantiation.  (Scala is really doing the same thing as C++ and C#, but it has a  nice syntax of specifying mixins at instantiation points. The  Scala compiler will generate an anonymous class that pre-loads  all of the business logic methods, and that class is intantiated  just at that one point.) When the object comes into existence it  has a hybrid type that offers the behaviors both of the base  domain class as well as the Use Case roles.</p>
<h3 id="Nested-Contexts"><a href="#Nested-Contexts" class="headerlink" title="Nested  Contexts"></a>Nested  Contexts</h3><p>One can imagine building rich Context objects that define  whole subgraphs of self-contained role relationships:  relationships so stable that they constitute a kind of domain in  their own right. If these Context objects have a small number of  public methods they can behave like domain objects. Consider a  Savings Account, which is often wrongly used as an example of a  class in simple courses on object orientation. A Savings Account  is really a collection of behaviors on roles, where the roles are  transactions, transaction logs, and audit trails. If Savings  Account is a Context, it can map these roles onto the right  objects for a given method (e.g., to calculate the balance of the  account or to generate a monthly statement) and then kick off the  computation on the suitable role. The Savings Account Context can  be used as a domain object by “higher-level” Context objects, and  it can call on Context objects below it. This is a powerful  concept supporting a multi-tiered domain model.   </p>
<h2 id="Traits-as-the-design-trick-to-combine-characteristics-and-purpose"><a href="#Traits-as-the-design-trick-to-combine-characteristics-and-purpose" class="headerlink" title="Traits as the design trick to combine characteristics and  purpose"></a>Traits as the design trick to combine characteristics and  purpose</h2><p>The question is: how do we do this? And the punch line is a  concept called a <em>trait</em>. If a <em>role</em> is an  analysis concept (from the mind of the end user), then a  <em>trait</em> is a general design concept that represents the  role, and its implementation varies from programming language to  programming language. For example, we can represent traits in C++  as templates whose member functions are composed with those of a  concrete class at compile time, so that the object exhibits both  the class and template behaviors at run time.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">. . . .</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">ConcreteAccountType</span>&gt; <span class="title">class</span> <span class="title">TransferMoneySourceAccount</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">transferTo</span><span class="params">(Currency amount)</span> </span>&#123;</span><br><span class="line">        beginTransaction();</span><br><span class="line">        <span class="keyword">if</span> (self()-&gt;availableBalance() &lt; amount) &#123;</span><br><span class="line">        . . . .</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">. . . .</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SavingsAccount</span>:</span></span><br><span class="line">    <span class="keyword">public</span> Account,</span><br><span class="line">    <span class="keyword">public</span> TransferMoneySourceAccount&lt;SavingsAccount&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">decreaseBalance</span><span class="params">(Currency amount)</span> </span>&#123;</span><br><span class="line">        . . . .</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">. . . .</span><br></pre></td></tr></table></figure>

<p>In <a href="http://www.artima.com/shop/programming_in_scala" target="_blank" rel="noopener">   Scala</a><em>trait</em></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">. . . .</span><br><span class="line"></span><br><span class="line">trait TransferMoneySourceAccount extends SourceAccount &#123;</span><br><span class="line">  <span class="keyword">this</span>: Account =&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This code is reviewable and testable!</span></span><br><span class="line">  def transferTo(amount: Currency) &#123;</span><br><span class="line">    beginTransaction()</span><br><span class="line">    <span class="keyword">if</span> (availableBalance &lt; amount) &#123;</span><br><span class="line">        . . . .</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">. . . .</span><br><span class="line">val source = <span class="keyword">new</span> SavingsAccount with TransferMoneySourceAccount</span><br><span class="line">val destination = <span class="keyword">new</span> CheckingAccount with TransferMoneyDestinationAccount</span><br><span class="line">. . . .</span><br></pre></td></tr></table></figure>

<p>In Squeak Smalltalk, we implement methodful roles with Squeak  Traits used according to certain conventions pioneered by  Schärli<a href="https://www.artima.com/articles/dci_vision.html#r4" target="_blank" rel="noopener">4</a> and  inject a trait’s methods into appropriate Data classes by adding  its methods to the class method tables at compile time.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">. . . . </span><br><span class="line"></span><br><span class="line">RoleTrait named: #TransferMoneySource   </span><br><span class="line">   uses: &#123;&#125;</span><br><span class="line">   roleContextClassName: #MoneyTransferContext  </span><br><span class="line">   category: 'BB5Bank-Traits' </span><br><span class="line">   . . . . </span><br><span class="line"></span><br><span class="line">TransferMoneySource&gt;&gt;transfer: amount</span><br><span class="line">   self balance &lt; amount </span><br><span class="line">      ifTrue: [self notify: 'Insufficient funds'. ^self].</span><br><span class="line">   . . . .</span><br><span class="line"></span><br><span class="line">Object subclass: #Account   uses: TransferMoneySource   instanceVariableNames: 'balance'   classVariableNames: ''   poolDictionaries: ''   category: 'BB5Bank-Data'</span><br></pre></td></tr></table></figure>

<p>DCI implementations also exist in C#/.Net (Christian Horsdal  Gammelgaard), Ruby (Steen Lenmann), Python (David Byers and Serge  Beaumont), and Groovy (Lars Vonk). The Qi4J environment (Richard  Öberg and Steen Lehmann) is pushing forward the ability to  express traits in a Java environment.</p>
<h1 id="Properties-of-DCI"><a href="#Properties-of-DCI" class="headerlink" title="Properties of DCI"></a>Properties of DCI</h1><ul>
<li><em>We use roles to capture the main user concepts that    participate in a Use Case requirement.</em> Roles are    first-class components of the end user cognitive model, so we    want to reflect them in the code. Semantically, these roles map    closely to the concept of <em>interfaces</em> in Java or .Net.    However, we use interfaces to capture only the overall form of    the behavioral design. Ultimately, our goal is to capture the    Use Cases in code, and we’ll use other language features to do    that. The approach varies with programming language. In Squeak    and Scala, we can use <em>traits</em> directly. In C++ we can    simulate traits using templates. In other languages, we can use    classes together with some tricks that associate methods of one    class with an object of another.</li>
<li><em>We use objects to capture the deep domain concepts that    come from experience and tacit knowledge, as</em> barely    <em>smart data</em>. In the old days we distributed    responsibilities to classes using CRC cards (<em>C</em>lasses,    <em>R</em>esponsibilities, and <em>C</em>ollaborations). But it    isn’t classes that exhibit responsibilities: roles do. We find    this when we ask people to elicit their recollection of some    activity: people talk about the task of ordering a book, of    transferring money between accounts, and most such transactions    as involving roles rather than classes.</li>
<li><em>The software exhibits the open-closed principle</em>    Whereas the open-closed principle based on inheritance alone    led to poor information hiding, the DCI style maintains the    integrity of both the domain classes and the roles. Classes are    closed to modification but are opened to extension through    injection of roles.</li>
<li>​      <em>DCI is a natural fit for Agile software development</em>.      It allows programmers to connect directly with the end user      mental model (going beyond just customers to engage end user      interactions instead of processes and tools). We can      therefore use shared customer vocabulary and iterate the code      side by side with them (customer collaboration over contract      negotiation). We can reason about the form of task sequencing      (which greatly raises the chance of delivering working      software—because at least the programmer can understand it,      and the translation distance to the end user mental model is      much shorter). And, last but not least, it separates the      rapidly changing Use Case part from the stable domain part so      that we embrace change. Each of these benefits ties directly      to a provision of the Agile Manifesto (<a href="http://www.agilemanifesto.org" target="_blank" rel="noopener">http://www.agilemanifesto.org</a>).    </li>
</ul>
<h2 id="Other-bits"><a href="#Other-bits" class="headerlink" title="Other bits"></a>Other bits</h2><p>There are certainly other models in the user’s head. One  common darling of some software engineering camps is <em>business  rules</em>. DCI doesn’t provide a convenient home to capture  rules; that is perhaps a weakness in the same way that the  failure to capture interactions was a weakness of primordial  object orientation. Many other formalisms, such as states and  state transitions, can be viewed as derived models that come from  the data and usage models. For example, I know that it makes  sense to depress the accelerator on my car only if I am in a  state where the gearbox is engaged; the state machine  representation of this constellation would show an allowable  accelerator “message” to occur only in the gearbox “state.”  However, this transition can also be viewed as a sequence of  steps that are described in terms of roles (accelerator, gearbox,  engine). A quick check with our intuition suggests that this  latter model is a better fit for our intuition, while the state  machine model may be a better fit for a nerd-centric view.</p>
<p>However, we offer no firm research evidence for such  conclusions. In the interest of full disclosure, this is an area  where we believe additional research could bear fruit. However,  lacking a complete picture is probably not a good reason to move  to a more faithful picture, and we view DCI as an important step  in that direction.</p>
<h2 id="DCI-fulfilling-a-bit-of-history"><a href="#DCI-fulfilling-a-bit-of-history" class="headerlink" title="DCI fulfilling a bit of history"></a>DCI fulfilling a bit of history</h2><p>DCI is in many respects a unification of many past paradigms  that have appeared as side-cars to object-oriented programming  over the years.</p>
<ul>
<li>Though aspect-oriented programming (AOP) has other uses as    well, DCI meets many applications of AOP and many of the goals    of Aspects in separating concerns. In line with the fundamental    principles underlying AOP, DCI is based on a deep form of    reflection or meta-programming. Unlike Aspects, Roles aggregate    and compose nicely. Contexts provide a scoped closure of    association between sets of roles, while Aspects only pair with    the objects to which they are applied.</li>
<li>In many ways DCI reflects a mix-in style strategy, though    mix-ins themselves lack the dynamics that we find in Context    semantics.</li>
<li>DCI implements many of the simple goals of <a href="http://sites.google.com/a/gertrudandcope.com/info/Publications/Mpd/Thesis.pdf?attredirects=0" target="_blank" rel="noopener">       multi-paradigm design</a>, in being able to separate      procedural logic from object logic. However, DCI has much      better coupling and cohesion results than the more      brute-force techniques of multi-paradigm design offer.    </li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:null">Wang YangYang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://wangyangyangisme.github.io/2019/10/25/architecture-DCI%E6%9E%B6%E6%9E%84/">http://wangyangyangisme.github.io/2019/10/25/architecture-DCI%E6%9E%B6%E6%9E%84/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://wangyangyangisme.github.io" target="_blank">WangYangYang</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/architecture/">architecture</a></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=null" async="async"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/donat/76bc52296bcf2e0b7a1d628106ffcd52.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/donat/fab2285fdcd13ead0a8b4a853c659d03.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/10/25/architecture-CQRS%E6%A8%A1%E5%BC%8F/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/16ab95126bb92ad479a36b0e70a0cc69.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CQRS模式</div></div></a></div><div class="next-post pull_right"><a href="/2019/10/25/architecture-%E5%85%AD%E8%BE%B9%E5%BD%A2%E6%9E%B6%E6%9E%84/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/24169e4e588622ff1207521678c89699.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">六边形架构</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/10/27/architecture-软件设计的七大原则/" title="软件设计的七大原则"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/a8dea43b51983e0fc7f9c0e689c0e217.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-27</div><div class="relatedPosts_title">软件设计的七大原则</div></div></a></div><div class="relatedPosts_item"><a href="/2019/10/25/architecture-领域驱动设计/" title="领域驱动设计"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/31ce17fbd9dc0ee80bbe035015d399dd.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-25</div><div class="relatedPosts_title">领域驱动设计</div></div></a></div><div class="relatedPosts_item"><a href="/2019/10/25/architecture-CQRS模式/" title="CQRS模式"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/16ab95126bb92ad479a36b0e70a0cc69.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-25</div><div class="relatedPosts_title">CQRS模式</div></div></a></div><div class="relatedPosts_item"><a href="/2019/10/25/architecture-六边形架构/" title="六边形架构"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/24169e4e588622ff1207521678c89699.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-25</div><div class="relatedPosts_title">六边形架构</div></div></a></div><div class="relatedPosts_item"><a href="/2019/10/25/architecture-Clean架构/" title="Clean架构"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/c4bfdae0870cf61b60206d8521077d02.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-25</div><div class="relatedPosts_title">Clean架构</div></div></a></div><div class="relatedPosts_item"><a href="/2019/10/25/architecture-常见的五种软件架构/" title="常见的五种软件架构"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/wangyangyangisme/CDN@latest/cover/architecture/30c79bc2b36136d52bd197a8c0752131.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-10-25</div><div class="relatedPosts_title">常见的五种软件架构</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: true,
  verify: false,
  appId: '49gEIIGN7uRbL6vHhieSpBzM-MdYXbMMI',
  appKey: 'uqts0urLKwikYQ0fKmIkMHBE',
  placeholder: '请留下你的脚印',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Wang YangYang</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://wangyangyangisme.github.io/">blog</a>!</div><div class="icp"><a><img class="icp-icon" src="/img/icp.png"/><span></span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/click_heart.js"></script><script src="/js/search/algolia.js"></script></body></html>